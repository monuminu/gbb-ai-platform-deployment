import{b as ue,r as u,j as e,I as y,B as R,C as se,S as l,h,T as z,n as K,e as ee,ap as jt,L as yt,A as Z,i as ze,M as X,D as N,N as Y,m as B,z as bt,d as V,g as wt,a as re,p as ie,a3 as Ct,o as ne,v as me,l as Fe,w as Ae,ab as ye,a4 as be,a5 as _e,s as L,a9 as St,aq as vt,ar as kt,y as It,F as Dt,P as Wt,R as Rt}from"./index-f7c4dfad.js";import{_ as Oe,L as pe}from"./plus-fill-f9c9dd5d.js";import{f as $t,L as Tt,D as zt,_ as Ft,G as At}from"./tool-f255544f.js";import{u as _t,d as Ot}from"./app-gallery-78b50b87.js";import{E as Pe}from"./image-f9ea5de7.js";import{I as Pt,L as Lt,C as ge}from"./numeral-b65a1435.js";import{s as Le,C as Mt}from"./custom-date-range-picker-998109e2.js";import{T as fe,L as Me,I as Nt}from"./TextField-5cd6dfc4.js";import{C as oe,A as Ne,D as Be,c as Bt,a as Ee,b as Ge}from"./DialogContent-12fa3194.js";import{_ as Et}from"./more-horizontal-fill-3cef82a0.js";import{_ as He}from"./arrow-ios-forward-fill-2d56b1a6.js";import{c as we,a as Ye,d as Gt,e as Ht}from"./confirm-dialog-e205398d.js";import{L as Yt,_ as Ut,a as qt,b as Vt,c as Jt,d as Ue,m as Kt,p as Qt,e as Xt,f as Zt,C as en}from"./index-491c3250.js";import{_ as tn}from"./cloud-upload-fill-a41285d1.js";import{S as te}from"./index-8fda52a8.js";import{R as qe,v as Ve,w as nn,x as ae,y as le,z as Je,A as Ke,B as Qe,E as sn,F as rn,H as on,I as Xe,J as Ze}from"./ChatMessageInputWebPopover-38e1844e.js";import{M as q}from"./markdown-e1ecb202.js";import{j as et,b as an}from"./rag-source-dialog-bf54fa9f.js";import{f as tt}from"./file-thumbnail-ebe9c7d7.js";import{L as ce}from"./use-light-box-1c577ab5.js";import{c as ln,a as xe,u as cn,o as dn,F as hn,R as Ce}from"./rhf-autocomplete-204470f7.js";import"./coming-soon-image-464dfa9d.js";import{R as xn}from"./rhf-text-field-2f3dfe59.js";import{a as Se}from"./format-number-ad5a4a25.js";const pn=["Image","Productivity","Programming","Writing","Lifestyle","Education"];function un({openDateRange:t,onCloseDateRange:n,onOpenDateRange:r,filters:o,onFilters:c,dateError:i,typeOptions:s}){const d=ue(),f=o.categories.length?o.categories.slice(0,2).join(","):"All categories",x=u.useCallback(b=>{c("name",b.target.value)},[c]),S=u.useCallback(b=>{c("startDate",b)},[c]),C=u.useCallback(b=>{c("endDate",b)},[c]),D=u.useCallback(b=>{const $=o.categories.includes(b)?o.categories.filter(w=>w!==b):[...o.categories,b];c("categories",$)},[o.categories,c]),p=u.useCallback(()=>{d.onClose(),c("categories",[])},[c,d]),a=e.jsx(fe,{size:"small",value:o.name,onChange:x,placeholder:"Search",InputProps:{startAdornment:e.jsx(Pt,{position:"start",children:e.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{width:{xs:1,md:260}}}),m=e.jsxs(e.Fragment,{children:[e.jsxs(R,{size:"small",color:"inherit",onClick:d.onOpen,endIcon:e.jsx(y,{icon:d.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:-.5}}),children:[f,o.categories.length>2&&e.jsxs(Lt,{color:"info",sx:{ml:1},children:["+",o.categories.length-2]})]}),e.jsx(se,{open:d.open,onClose:d.onClose,sx:{p:2.5},children:e.jsxs(l,{spacing:2.5,children:[e.jsx(h,{gap:1,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(4, 1fr)"},children:s.map(b=>{const $=o.categories.includes(b);return e.jsx(l,{spacing:1,direction:"row",alignItems:"center",onClick:()=>D(b),sx:{px:1.75,py:1.25,borderRadius:20,cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",border:w=>`1px solid ${w.palette.divider}`,...$&&{border:w=>`1px solid ${w.palette.info.dark}`,boxShadow:w=>`inset 0 0 0 1px ${w.palette.info.dark}`}},children:e.jsx(z,{variant:"subtitle2",fontSize:"13px",lineHeight:1,children:b})},b)})}),e.jsxs(l,{spacing:1.5,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[e.jsx(R,{size:"small",variant:"outlined",color:"inherit",onClick:p,children:"Clear"}),e.jsx(R,{size:"small",variant:"contained",onClick:d.onClose,children:"Apply"})]})]})})]}),W=e.jsxs(e.Fragment,{children:[e.jsx(R,{size:"small",color:"inherit",onClick:r,endIcon:e.jsx(y,{icon:t?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:-.5}}),children:o.startDate&&o.endDate?Le(o.startDate,o.endDate):"Select date"}),e.jsx(Mt,{variant:"calendar",startDate:o.startDate,endDate:o.endDate,onChangeStartDate:S,onChangeEndDate:C,open:t,onClose:n,selected:!!o.startDate&&!!o.endDate,error:i})]});return e.jsxs(l,{spacing:1,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},sx:{width:1},children:[a,e.jsxs(l,{spacing:1,direction:"row",alignItems:"center",justifyContent:"flex-end",flexGrow:1,children:[W,m]})]})}function mn({filters:t,onFilters:n,canReset:r,onResetFilters:o,results:c,...i}){const s=Le(t.startDate,t.endDate),d=x=>{const S=t.categories.filter(C=>C!==x);n("categories",S)},f=()=>{n("startDate",null),n("endDate",null)};return e.jsxs(l,{spacing:1.5,...i,sx:{mb:2},children:[e.jsxs(h,{sx:{typography:"body2"},children:[e.jsx("strong",{children:c}),e.jsx(h,{component:"span",sx:{color:"text.secondary",ml:.75},children:"results found"})]}),e.jsxs(l,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[!!t.categories.length&&e.jsx(ve,{label:"Categories:",children:t.categories.map(x=>e.jsx(oe,{label:x,size:"small",onDelete:()=>d(x)},x))}),t.startDate&&t.endDate&&e.jsx(ve,{label:"Date:",children:e.jsx(oe,{size:"small",label:s,onDelete:f})}),r&&e.jsx(R,{color:"error",onClick:o,startIcon:e.jsx(y,{icon:"gravity-ui:trash-bin",width:18}),children:"Clear"})]})]})}function ve({label:t,children:n,sx:r,...o}){return e.jsxs(l,{component:K,variant:"outlined",spacing:1,direction:"row",sx:{p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed",...r},...o,children:[e.jsx(h,{component:"span",sx:{typography:"subtitle2"},children:t}),e.jsx(l,{spacing:1,direction:"row",flexWrap:"wrap",children:n})]})}function gn(t){return Math.round(parseFloat(t)*16)}function fn(t){const n=ee(),r=jt(),o=n.breakpoints.up(r==="xl"?"lg":r),i=(t==="h1"||t==="h2"||t==="h3"||t==="h4"||t==="h5"||t==="h6")&&n.typography[t][o]?n.typography[t][o]:n.typography[t],s=gn(i.fontSize),d=Number(n.typography[t].lineHeight)*s,{fontWeight:f,letterSpacing:x}=n.typography[t];return{fontSize:s,lineHeight:d,fontWeight:f,letterSpacing:x}}const jn=u.forwardRef(({asLink:t,variant:n="body1",line:r=2,persistent:o=!1,children:c,sx:i,...s},d)=>{const{lineHeight:f}=fn(n),x={overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:r,WebkitBoxOrient:"vertical",...o&&{height:f*r},...i};return t?e.jsx(yt,{color:"inherit",ref:d,variant:n,sx:{...x},...s,children:c}):e.jsx(z,{ref:d,variant:n,sx:{...x},...s,children:c})}),ke=jn;function nt({person:t,onChangePermission:n}){const[r,o]=u.useState(null),c=d=>{o(d.currentTarget)},i=()=>{o(null)},s=d=>{n(d,t.email)};return e.jsxs(e.Fragment,{children:[e.jsxs($t,{disableGutters:!0,children:[e.jsx(Yt,{children:e.jsx(Z,{alt:t.name,src:t.avatar})}),e.jsx(Tt,{primary:t.name,secondary:e.jsx(ze,{title:t.email,children:e.jsx("span",{children:t.email})}),primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0},sx:{flexGrow:1,pr:1}}),e.jsxs(R,{size:"small",color:"inherit",endIcon:e.jsx(y,{icon:r?Ut:qt}),onClick:c,sx:{flexShrink:0,textTransform:"unset",fontWeight:"fontWeightMedium","& .MuiButton-endIcon":{ml:0},...r&&{bgcolor:"action.selected"}},children:["Can ",t.permission?t.permission:"view"]})]}),e.jsx(se,{hiddenArrow:!0,open:r,onClose:i,sx:{width:160},children:e.jsxs(e.Fragment,{children:[e.jsxs(X,{onClick:()=>{i(),s("view")},sx:{...t.permission==="view"&&{bgcolor:"action.selected"}},children:[e.jsx(y,{icon:Vt}),"Can view"]}),e.jsxs(X,{onClick:()=>{i(),s("edit")},sx:{...t.permission==="edit"&&{bgcolor:"action.selected"}},children:[e.jsx(y,{icon:Jt}),"Can edit"]}),e.jsx(N,{sx:{borderStyle:"dashed"}}),e.jsxs(X,{onClick:()=>{i()},sx:{color:"error.main"},children:[e.jsx(y,{icon:Ue}),"Remove"]})]})})]})}function yn({setQuery:t,maintainers:n}){const r=[],c=i=>{};return e.jsx(Ne,{multiple:!0,size:"medium",limitTags:2,fullWidth:!0,popupIcon:null,noOptionsText:e.jsx(Pe,{filled:!0,title:"No Data",sx:{py:10}}),onChange:(i,s)=>c(),onInputChange:(i,s)=>t(s),options:r,value:n,getOptionLabel:i=>i.email,isOptionEqualToValue:(i,s)=>i.email===s.email,renderOption:(i,s,{inputValue:d,selected:f})=>{const{name:x,email:S,avatar:C}=s,D=Kt(S,d),p=Qt(S,D);return e.jsxs(h,{component:"li",sx:{p:"8px !important"},...i,children:[!1,e.jsxs(e.Fragment,{children:[e.jsxs(h,{sx:{mr:1.5,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(Z,{alt:x,src:C,sx:{width:32,height:32}}),e.jsx(h,{sx:{top:0,opacity:0,width:"100%",height:"100%",display:"flex",position:"absolute",alignItems:"center",justifyContent:"center",bgcolor:a=>Y(a.palette.grey[900],.6),transition:a=>a.transitions.create("opacity",{easing:a.transitions.easing.easeInOut,duration:a.transitions.duration.shorter}),...f&&{opacity:1,color:"primary.main"}},children:e.jsx(y,{icon:Xt})})]}),p.map((a,m)=>e.jsx(z,{variant:"subtitle2",color:a.highlight?"primary":"textPrimary",children:a.text},m))]})]})},renderTags:(i,s)=>i.map((d,f)=>{const{name:x,email:S,avatar:C}=d;return u.createElement(oe,{...s({index:f}),key:S,size:"small",label:x,variant:"soft",avatar:e.jsx(Z,{alt:x,src:C})})}),renderInput:i=>e.jsx(fe,{label:"",...i,placeholder:"#Add maintainers"})})}function bn({maintainers:t,query:n,setQuery:r,onAddMaintainer:o,onChangePermission:c,open:i,onClose:s,...d}){const f=t?t.length:0;return e.jsxs(Be,{fullWidth:!0,maxWidth:"xs",open:i,onClose:s,...d,children:[e.jsx(zt,{sx:{p:3,pb:3},children:" Add maintainer "}),e.jsxs(Bt,{sx:{overflow:"unset",p:3},children:[e.jsx(l,{direction:"row",spacing:1,sx:{mb:3},children:e.jsx(yn,{query:n,setQuery:r,onAddMaintainer:o,maintainers:t})}),f>0&&e.jsx(B,{sx:{maxHeight:60*6},children:e.jsx(Me,{disablePadding:!0,children:t&&t.map(x=>e.jsx(nt,{person:x,onChangePermission:c},x.email))})})]}),e.jsx(Ee,{sx:{justifyContent:"right"},children:s&&e.jsx(R,{variant:"outlined",color:"inherit",onClick:s,children:"Close"})})]})}const wn=["default.main","primary.main","success.main","secondary.main","info.main","warning.main","error.main"],Cn=t=>t.replace("main","")||"default";function Sn({item:t,open:n,favorited:r,onFavorite:o,onCopyLink:c,onClose:i,onDeleteRow:s,...d}){const f=u.useRef(null),{title:x,scenarios:S,maintainers:C,dateCreated:D,dateModified:p}=t,a=!1,[m,W]=u.useState(!1),[b,$]=u.useState(x),[w,E]=u.useState(C),[_,F]=u.useState(null),[T,U]=u.useState(""),[Q,J]=u.useState(!1),[j,v]=u.useState(-1),[M,k]=u.useState(!0),[g,O]=u.useState(S||[]),[de,st]=u.useState(!0),rt=w&&!!w.length,it=I=>{F(I.currentTarget)},ot=()=>{F(null)},at=I=>{U(""),E(I)},lt=I=>{$(I.target.value)},ct=u.useCallback(I=>{O(H=>I.map(G=>{const P=H.find(he=>he.title===G);return{title:G,color:P?P.color:"default"}})),v(-1)},[]),dt=u.useCallback(I=>{O(H=>{const A=[...H];return A[j]={...A[j],color:I.replace(".main","")},A})},[j]),ht=()=>{k(!M)},je=(I,H)=>{const A=w.findIndex(he=>he.email===H);if(A===-1)return;const G={...w[A],permission:I};let P=[];A===0?P=P.concat(G,w.slice(1)):A===w.length-1?P=P.concat(w.slice(0,-1),G):A>0&&(P=P.concat(w.slice(0,A),G,w.slice(A+1))),E(P)},xt=()=>{st(!de)},pt=()=>{J(!0)},ut=()=>{J(!1)},mt=()=>{W(!0)},gt=()=>{W(!1)},ft=async()=>{try{i()}catch{}};return e.jsxs(e.Fragment,{children:[e.jsxs(bt,{open:n,onClose:i,slotProps:{backdrop:{invisible:!0}},anchor:"right",PaperProps:{sx:{width:320}},...d,children:[e.jsxs(B,{sx:{height:1},children:[e.jsx(h,{sx:{p:2,px:2.5},children:e.jsx(z,{variant:"h6",children:" Info "})}),e.jsxs(l,{spacing:2.5,justifyContent:"center",sx:{p:2.5,bgcolor:"background.neutral"},children:[e.jsxs(l,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(y,{icon:Zt,width:38,height:38,sx:{color:"primary.dark",width:32}}),e.jsx(Nt,{fullWidth:!0,value:b,onChange:lt,sx:{flexGrow:1,"& .MuiInputBase-input":{py:1,borderRadius:1,typography:"h6",border:"solid 1px transparent",transition:I=>I.transitions.create(["padding-left","border-color"]),"&:hover, &:focus":{pl:.5,border:I=>`solid 1px ${I.palette.text.primary}`}}}})]}),e.jsx(N,{sx:{borderStyle:"dashed"}}),e.jsxs(l,{spacing:1,children:[e.jsx(Ie,{label:"Scenario",toggle:M,onToggle:ht}),M&&g&&e.jsx(Ne,{multiple:!0,limitTags:2,size:"small",disablePortal:!0,freeSolo:!0,options:[],value:g.map(I=>I.title),onChange:(I,H)=>{ct(H)},renderTags:(I,H)=>I.map((A,G)=>u.createElement(oe,{...H({index:G}),ref:f,size:"small",variant:"soft",color:Cn(g[G].color),label:A,key:A,onClick:P=>{v(G),it(P)}})),renderInput:I=>e.jsx(fe,{...I,placeholder:"Set scenario"})}),e.jsx(se,{open:_,onClose:ot,arrow:"bottom-center",sx:{p:.5},hiddenArrow:!0,children:e.jsx(en,{...g&&j>-1&&{color:`${g[j].color}.main`},colors:wn,onChange:I=>{dt(I.target.value)}})})]}),e.jsxs(l,{spacing:1.5,children:[e.jsx(Ie,{label:"Properties",toggle:de,onToggle:xt}),de&&e.jsxs(l,{spacing:1.5,children:[e.jsx(De,{label:"Created",value:D?we(D):"N/A"}),e.jsx(De,{label:"Modified",value:p?we(p):"N/A"})]})]})]}),e.jsxs(l,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{p:2.5},children:[e.jsx(z,{variant:"subtitle2",children:" Maintainers "}),e.jsx(V,{size:"small",color:"success",onClick:pt,sx:{p:0,width:24,height:24,color:"common.white",bgcolor:"primary.main","&:hover":{bgcolor:"primary.dark"}},children:e.jsx(y,{icon:Oe})})]}),rt&&e.jsx(Me,{disablePadding:!0,sx:{pl:2.5,pr:1},children:w&&w.map(I=>e.jsx(nt,{person:I,onChangePermission:je},I.email))})]}),e.jsxs(l,{sx:{p:2},direction:"row",spacing:1.5,children:[e.jsx(pe,{fullWidth:!0,loading:a,variant:"soft",color:"success",size:"medium",startIcon:e.jsx(y,{icon:tn}),onClick:ft,sx:{height:38},children:"Update"}),e.jsx(pe,{fullWidth:!0,variant:"soft",color:"error",size:"medium",startIcon:e.jsx(y,{icon:Ue}),onClick:mt,children:"Delete"})]})]}),e.jsx(bn,{open:Q,maintainers:w,query:T,setQuery:U,onAddMaintainer:at,onChangePermission:je,onClose:()=>{ut()}}),e.jsx(Ye,{open:m,onClose:gt,title:"Delete",content:"Are you sure to delete?",action:e.jsx(R,{variant:"contained",color:"error",onClick:s,children:"Delete"})})]})}function Ie({label:t,toggle:n,onToggle:r,...o}){return e.jsxs(l,{direction:"row",alignItems:"center",justifyContent:"space-between",...o,children:[e.jsxs(z,{variant:"subtitle2",children:[" ",t," "]}),e.jsx(V,{size:"small",onClick:r,children:e.jsx(y,{icon:n?"eva:chevron-up-fill":"eva:chevron-down-fill"})})]})}function De({label:t,value:n=""}){return e.jsxs(l,{direction:"row",sx:{typography:"caption",textTransform:"capitalize"},children:[e.jsx(h,{component:"span",sx:{width:80,color:"text.secondary",mr:2},children:t}),n]})}function vn({mlApp:t,index:n,onDelete:r,sx:o,...c}){const i=ee(),s=wt(),d=re(),f=ue(),x=re(),S=i.palette.mode==="light",[C,D]=u.useState(!1),p=t?JSON.parse(t.content):null,a=t?t.id:"",m=u.useCallback(async()=>{if(a){D(!0);try{await r(a),d.onFalse(),f.onClose()}catch(W){console.error(W)}finally{D(!1)}}},[a,r,d,f]);return p==null?null:e.jsxs(e.Fragment,{children:[e.jsx(K,{onClick:x.onTrue,sx:{width:1,borderRadius:1,overflow:"hidden",position:"relative",bgcolor:S?`${Y(i.palette.background.paper,.88)}`:`${Y(i.palette.background.default,.88)}`,boxShadow:i.customShadows.z1,"&:hover":{boxShadow:i.customShadows.z20},...x.value&&{boxShadow:i.customShadows.z20},...o},...c,children:e.jsxs(l,{alignItems:"left",spacing:1.5,sx:{height:1,p:2},children:[e.jsxs(l,{direction:"row",alignItems:"center",sx:{with:"100%",mb:1},children:[e.jsx(Z,{alt:"copilot",src:t.cover,sx:{width:48,height:48,mr:2}}),e.jsxs(l,{sx:{height:1,with:"100%"},children:[e.jsx(ke,{variant:"subtitle1",line:1,sx:{color:"text.primary"},children:t.title||""}),e.jsx(l,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{my:.5,mb:0},children:e.jsxs(h,{component:"span",sx:{typography:"caption",color:"text.disabled"},children:["By Lei, ",Gt(t.dateModified)]})})]})]}),e.jsxs(l,{spacing:1.5,sx:{position:"relative",width:1},children:[e.jsx(ke,{variant:"body2",line:2,sx:{color:"text.secondary",fontSize:"13px"},children:p.description||""}),e.jsxs(l,{direction:"row",alignItems:"center",sx:{mb:-1.25,ml:-1,mr:-.25,position:"relative",height:1},justifyContent:"space-between",children:[e.jsx(V,{color:f.open?"inherit":"default",onClick:W=>{W.stopPropagation(),f.onOpen(W)},children:e.jsx(y,{icon:Et})}),e.jsx(R,{to:ie.gbbai.gpts.details(t.id),component:Ct,size:"small",color:"inherit",sx:{height:24},endIcon:e.jsx(ne,{icon:He,style:{marginLeft:"-5px"}}),children:"Enter"})]})]})]})}),e.jsxs(se,{open:f.open,onClose:f.onClose,arrow:"right-center",sx:{width:128},children:[e.jsxs(X,{onClick:()=>{f.onClose(),s.push(ie.gbbai.gpts.edit(t.id))},children:[e.jsx(y,{icon:"solar:pen-bold",sx:{p:.2}}),"Edit"]}),e.jsxs(X,{onClick:d.onTrue,sx:{color:"error.main"},children:[e.jsx(y,{icon:"gravity-ui:trash-bin",width:18}),"Delete"]})]}),e.jsx(Ye,{open:d.value,onClose:d.onFalse,title:"Delete",content:e.jsx(e.Fragment,{children:"Are you sure to delete?"}),action:e.jsx(pe,{loading:C,variant:"contained",color:"error",onClick:m,children:"Delete"})}),e.jsx(Sn,{item:t,favorited:!1,onFavorite:()=>{},onCopyLink:()=>{},open:x.value,onClose:x.onFalse,onDeleteRow:()=>{}})]})}function kn({title:t,mlApps:n,onDelete:r}){return e.jsx(K,{sx:{pb:1.5,borderRadius:1,bgcolor:"background.dark"},children:e.jsxs(l,{children:[e.jsx(z,{variant:"h6",color:"text.secondary",noWrap:!0,sx:{px:2,mt:2,mb:1.25},children:t}),e.jsx(B,{sx:{width:324,maxHeight:"calc(100vh - 298px)"},children:e.jsx(l,{spacing:2,sx:{px:2,pt:1,pb:.5},children:n.map((o,c)=>e.jsx(vn,{index:c,mlApp:o,onDelete:r},o.id))})})]})})}function In({index:t,sx:n,...r}){return e.jsx(l,{component:K,variant:"outlined",sx:{p:2,borderRadius:2,...n},...r,children:e.jsxs(l,{spacing:2,sx:{width:280},children:[e.jsx(te,{sx:{paddingTop:"75%",borderRadius:1.5}}),[0].includes(Number(t))&&e.jsx(te,{sx:{paddingTop:"50%",borderRadius:1.5}}),[0,1].includes(Number(t))&&e.jsx(te,{sx:{paddingTop:"25%",borderRadius:1.5}}),[0,1,2].includes(Number(t))&&e.jsx(te,{sx:{paddingTop:"25%",borderRadius:1.5}})]})})}const Dn=["Writing","Productivity","Programming","Image","Lifestyle","Education"];function Wn({mlApps:t,isLoading:n,onDelete:r}){const o=e.jsx(l,{direction:"row",alignItems:"flex-start",spacing:3,children:[...Array(4)].map((s,d)=>e.jsx(In,{index:d},d))}),c=t.map(s=>s.category).filter(s=>Dn.includes(s)),i=[...new Set(c)];return e.jsxs(h,{sx:{px:"0 !important"},children:[n&&o,e.jsx(B,{sx:{pb:3},children:e.jsx(l,{spacing:3,direction:"row",alignItems:"flex-start",sx:{p:.25,px:0,height:1},children:i.map(s=>e.jsx(kn,{title:s,mlApps:t.filter(d=>d.category===s),onDelete:r},s))})})]})}const We={name:"",categories:[],startDate:null,endDate:null},Rn=e.jsx(h,{sx:{display:"grid",gap:4,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)",lg:"repeat(4, 1fr)"}},children:[...Array(4)].map((t,n)=>e.jsx(At,{item:!0,xs:12,sm:6,md:3,children:e.jsx(te,{variant:"rectangular",width:"100%",sx:{height:"calc(100vh - 176px)",borderRadius:1}})},n))});function vs(){const t=me(),{enqueueSnackbar:n}=Fe(),r=re(),o="latest",[c,i]=u.useState(0),[s,d]=u.useState(We),{apps:f,appsLoading:x,appsRefetching:S,refetch:C}=_t(),D=x||S,p=$n({apps:f,sortBy:o,filters:s}),a=p.filter(F=>F.source?F.source==="custom":!1),m=!!s.name||!!s.categories.length||!!s.startDate&&!!s.endDate,W=s.startDate&&s.endDate?s.startDate.getTime()>s.endDate.getTime():!1;u.useEffect(()=>{c>0&&C()},[C,c]);const b=u.useCallback((F,T)=>{d(U=>({...U,[F]:T}))},[d]),$=u.useCallback(async F=>{if(F.length!==0)try{const T=await Ot(F);T!=null&&T.success?n("Deleted successfully"):n("Failed to delete",{variant:"error"})}catch(T){n(`Error: ${JSON.stringify(T)}`,{variant:"error"})}},[n]),w=u.useCallback(()=>{i(Date.now())},[]),E=u.useCallback(()=>{d(We)},[]),_=e.jsx(l,{sx:{width:"100%"},spacing:1.5,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:e.jsx(un,{openDateRange:r.value,onCloseDateRange:r.onFalse,onOpenDateRange:r.onTrue,filters:s,onFilters:b,dateError:W,typeOptions:pn})});return e.jsxs(Ae,{maxWidth:t.themeStretch?!1:"xl",sx:{mb:-14},children:[e.jsxs(l,{sx:{mb:3},direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(z,{variant:"h4",textTransform:"capitalize",children:"Agent store"}),e.jsxs(l,{spacing:1,direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(R,{size:"small",color:"inherit",variant:"outlined",component:ye,path:ie.gbbai.gpts.workbench,startIcon:e.jsx(y,{icon:"fluent:open-16-filled",width:16}),sx:{borderRadius:.75,px:1.5,mr:0},children:"Workbench"}),e.jsx(R,{size:"small",variant:"contained",component:ye,path:ie.gbbai.gpts.create,startIcon:e.jsx(y,{icon:Oe,width:18}),sx:{borderRadius:.75,px:1.5,mr:0},children:"Agent"})]})]}),D&&Rn,!D&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{spacing:1,sx:{mb:3},alignItems:"center",justifyContent:"space-between",direction:"row",children:[_,e.jsx(ze,{title:"Refresh",children:e.jsx(V,{size:"small",onClick:w,sx:{width:30,height:30,color:"inherit",mt:{xs:.5,md:0},alignSelf:{xs:"start",md:"center"}},children:e.jsx(y,{icon:Ft,width:18})})})]}),m&&e.jsx(mn,{filters:s,onResetFilters:E,canReset:m,onFilters:b,results:p.length}),!D&&a.length>0&&e.jsx(Wn,{mlApps:a,isLoading:x,onDelete:$})]}),!D&&a.length===0&&e.jsx(Pe,{filled:!0,title:"No Agents",description:"Create one by clicking the + Agent button",imgUrl:"/assets/icons/empty/ic_cart.svg",sx:{py:1,borderRadius:1,height:280,backgroundColor:"transparent",border:"none"}})]})}const $n=({apps:t,sortBy:n,filters:r})=>{const{name:o,categories:c}=r;return n==="featured"&&(t=be.orderBy(t,["sold"],["desc"])),n==="newest"&&(t=be.orderBy(t,["createdAt"],["desc"])),o&&(t=t.filter(i=>i.title.toLowerCase().indexOf(o.toLowerCase())!==-1)),c.length&&(t=t.filter(i=>c.includes(i.category))),t},Tn=["jpg","gif","png","gif","bmp","svg","webp"],zn=new RegExp(`https.*\\.(${Tn.join("|")}).*(?=\\))`,"i"),Fn=L("div")(({theme:t})=>({display:"flex",marginBottom:t.spacing(3)})),An=L("div")(({theme:t})=>({maxWidth:680,padding:t.spacing(.25,2,.25,2),marginTop:t.spacing(.5),borderRadius:t.shape.borderRadius,boxShadow:`0 0 1px 0 ${Y(t.palette.mode==="light"?t.palette.grey[200]:t.palette.grey[400],.52)}, 0 1px 3px -1px ${Y(t.palette.mode==="light"?t.palette.grey[500]:t.palette.grey[700],.24)}`,backgroundColor:t.palette.background.paper})),_n=L(z)(({theme:t})=>({display:"flex",marginBottom:t.spacing(.75),color:t.palette.text.secondary})),Re=L("img")(({theme:t})=>({width:"100%",cursor:"pointer",objectFit:"cover",borderRadius:6,marginBottom:t.spacing(1.5),[t.breakpoints.up("md")]:{height:240,minWidth:296}})),On=t=>{let n=t;return t.startsWith("<")&&(n=n.slice(1)),t.endsWith(">")&&(n=n.slice(0,-1)),n};async function Pn(t,n,r,o){console.log("feedback")}function ks({message:t,avatarUrl:n,conversation:r,onOpenLightbox:o,isLastMessage:c,onOpenRagSourcePopover:i}){const s=ee(),d=_e("up","sm"),x=me().themeStretch;Fe();const[S,C]=u.useState(""),D=et(t.thoughts),p=r.participants.find(k=>k.id===t.senderId),m=(t.senderId==="user"?{type:"me"}:{avatar:p==null?void 0:p.avatarUrl,name:p==null?void 0:p.name}).type==="me",W=t.contentType==="image",b=!!t.function_calls&&t.function_calls.length>0&&!!t.function_calls[0].results&&(t.function_calls[0].funcName.includes("sales")||t.function_calls[0].funcName.includes("stock")),$=t.body?t.body.match(/\/(.*\.mp4)/):null,w=$?`/${$[1]}`:"",E=t.body?t.body.match(zn):null,_=E?E[0]:"",F=tt(new Date(t.createdAt),{addSuffix:!0}),T=t&&t.body&&(t.body.startsWith("(SYS)Working")||t.body.startsWith("(SYS)function")),U=k=>{t.ddb_uuid!==void 0&&t.log_timestamp!==void 0&&Pn(t.ddb_uuid,t.log_timestamp),C(g=>k===g?"":k)},Q=k=>{try{if(T)return null;let g=k;return _.length>0&&(g.includes("](http")&&!g.includes("![")&&(g=g.replace("[","![")),g.endsWith(")。")&&(g=g.replace(")。",")"))),e.jsxs(h,{onClick:()=>{_.length>0&&o(_)},children:[m&&e.jsx(h,{sx:{py:1.25,wordBreak:"break-word",typography:"body1",whiteSpace:"pre-line"},children:g}),!m&&e.jsx(q,{sx:{"& .component-image":{mt:1,borderRadius:1},"& code":{wordBreak:"break-word",whiteSpace:"pre-wrap"},"& a":{wordBreak:"break-all"},"& pre, & pre > code":{py:1,lineHeight:1.75},...!d&&{"& pre, & pre > code":{py:1,lineHeight:1.5,whiteSpace:"pre-wrap"}}},children:g})]})}catch{return e.jsx(h,{sx:{typography:"body2"},children:k.replace("<eos>","")})}},J=k=>{try{return T?null:e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsx(q,{children:k.replace("<eos>","")})}),e.jsx(h,{sx:{py:1.5},children:e.jsx(K,{sx:{pb:2,pt:2.9,display:"flex",alignItems:"center",borderRadius:"5px",backgroundColor:`${s.palette.grey[900]}`},children:e.jsx(qe,{url:w,width:"100%",height:"100%",playIcon:e.jsx(ne,{icon:Ve,width:36,height:36}),controls:!0})})})]})}catch{return e.jsx(h,{sx:{typography:"body2"},children:k.replace("<eos>","")})}},j=k=>{try{return e.jsxs(e.Fragment,{children:[Q(k),!m&&e.jsx(nn,{function_calls:t.function_calls||[]}),k&&M()]})}catch{return e.jsxs(e.Fragment,{children:[k?e.jsx(h,{sx:{typography:"body2"},children:k}):Q("Nothing to display"),k&&M()]})}},v=k=>{if(k.startsWith("(SYS)function")){const g=t.body.split(":")[1].trim(),O=k.includes("calling")?"running":"executed";return e.jsxs(l,{children:[e.jsxs(l,{direction:"row",alignItems:"center",spacing:1.5,sx:{width:"100%"},children:[e.jsx(y,{icon:O==="running"?ae:le,sx:{ml:-.5,height:24,width:24,color:`${s.palette.primary.main}`}}),e.jsxs(h,{children:[O==="running"&&e.jsxs(l,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(h,{sx:{fontSize:14,py:1},children:"Calling: "}),e.jsx(q,{sx:{transform:"translateY(-1px)"},children:`\`${g}\``})]}),O==="executed"&&e.jsx(l,{direction:"row",alignItems:"center",spacing:1,children:e.jsx(h,{sx:{fontSize:14,py:1},children:"Keep working ..."})}),e.jsx(ce,{color:"primary",sx:{mt:0,mb:1.5}})]})]}),O==="executed"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{sx:{mt:.5,borderStyle:"dashed"}}),e.jsx(l,{spacing:0,sx:{my:1},children:e.jsxs(l,{direction:"row",alignItems:"center",spacing:2,sx:{my:-.5},children:[e.jsx(y,{icon:Je,sx:{ml:-.05,height:17,width:17,transform:"translateY(1.5px)",color:`${s.palette.success.main}`}}),e.jsx(q,{sx:{"& code":{fontSize:12,borderRadius:.5}},children:`\`${g}\``}),e.jsx(h,{sx:{fontSize:13,py:1,ml:-1.25,transform:"translateY(0.5px)"},children:"executed"}),e.jsx(V,{size:"small",onClick:()=>{},sx:{ml:-1,transform:"translateY(1.5px)"},children:e.jsx(y,{icon:Ke,sx:{height:16,width:16,color:`${s.palette.text.secondary}`}})})]})})]})]})}return k.startsWith("(SYS)Working on it")?e.jsxs(l,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:le,sx:{ml:-.5,height:24,width:24,color:`${s.palette.primary.main}`}}),e.jsxs(h,{children:[e.jsx(h,{sx:{fontSize:15,py:1},children:"Working on it"}),e.jsx(ce,{color:"primary",sx:{mt:0,mb:1.5}})]})]}):null},M=()=>{var k;return t&&t.body&&!m&&!T&&e.jsxs(e.Fragment,{children:[e.jsx(N,{sx:{borderStyle:"dashed",mb:1,mt:1.5}}),e.jsxs(l,{spacing:1,direction:"row",alignItems:"center",sx:{mt:-.4,mb:.5,maxWidth:"100%",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:[t.thoughts&&t.thoughts.length>2&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{sx:{px:0,py:0,fontSize:"12px",fontWeight:600,minWidth:64,color:"text.secondary"},onClick:()=>{i(t.thoughts,"All")},children:["Sources (",D.length,")"]}),e.jsx(B,{sx:{flexGrow:1,maxWidth:"99%"},children:e.jsx(l,{display:"flex",spacing:1,direction:"row",children:D.length>0&&D.map((g,O)=>e.jsx(h,{children:e.jsx(R,{variant:"soft",color:"info",size:"medium",startIcon:e.jsx(y,{icon:"codicon:book",sx:{height:14,mx:-.5}}),sx:{px:1.25,height:24,fontSize:"12px",fontWeight:400,maxWidth:180,overflow:"auto",textTransform:"none",textOverflow:"ellipsis",whiteSpace:"noWrap",borderRadius:.5,justifyContent:"flex-start",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},onClick:()=>{i(t.thoughts,g)},children:g})},O))})}),e.jsx(N,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"solid"}})]}),((k=t.sources)==null?void 0:k.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"caption",sx:{fontWeight:600,minWidth:64},children:["Sources (",t.sources.length,")"]}),e.jsx(B,{sx:{flexGrow:1,maxWidth:"99%"},children:e.jsx(l,{display:"flex",spacing:1,direction:"row",children:t.sources.map((g,O)=>e.jsx(h,{children:e.jsx(R,{href:On(g.url),target:"_blank",variant:"soft",color:"info",size:"medium",startIcon:e.jsx(y,{icon:Qe,sx:{height:14,mx:-.5}}),sx:{px:1.25,height:24,fontSize:"12px",fontWeight:400,maxWidth:140,overflow:"auto",textTransform:"none",textOverflow:"ellipsis",whiteSpace:"noWrap",borderRadius:.5,justifyContent:"flex-start"},children:g.label})},O))})}),e.jsx(N,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"solid"}})]}),t.function_calls&&t.function_calls.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"caption",sx:{fontWeight:600,minWidth:80,color:"text.secondary"},children:["Function calls (",t.function_calls.length,")"]}),e.jsx(B,{sx:{flexGrow:1,maxWidth:"99%"},children:e.jsx(l,{display:"flex",spacing:1,direction:"row",children:t.function_calls.map((g,O)=>e.jsx(h,{children:e.jsx(R,{variant:"soft",color:"warning",size:"medium",startIcon:e.jsx(y,{icon:ae,sx:{height:14,mx:-.5}}),sx:{px:1.25,height:24,fontSize:"12px",fontWeight:400,maxWidth:180,overflow:"auto",textTransform:"none",textOverflow:"ellipsis",whiteSpace:"noWrap",borderRadius:.5,justifyContent:"flex-start"},children:g.funcName})},O))})}),e.jsx(N,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"solid"}})]}),(!t.thoughts||t.thoughts.length<3)&&(!t.sources||t.sources.length===0)&&(!t.function_calls||t.function_calls.length===0)&&e.jsx(h,{sx:{width:"100%"}}),e.jsx(l,{direction:"row",children:["Yes","No"].map(g=>e.jsx(V,{color:Ln(g,S),onClick:()=>U(g),children:e.jsx(ne,{icon:g==="Yes"?sn:rn,width:12,height:12})},g))})]})]})};return e.jsxs(Fn,{children:[!m&&e.jsx(Z,{alt:"customGPT",src:n,sx:{width:30,height:30,mr:1.25}}),e.jsx(h,{sx:{display:"flex",...m&&{ml:"auto"}},children:e.jsxs("div",{children:[e.jsx(_n,{variant:"caption",sx:{...m&&{justifyContent:"flex-end"}},children:F.startsWith("0 sec")?"Just now":F}),e.jsxs(An,{sx:{...W&&{p:1},...m&&{color:"grey.800",bgcolor:"#d5f6fe"},...!m&&t.body&&!T&&{pt:.75,px:2.25,minWidth:{xs:"auto",md:b?600:400}},...b&&{pt:.75,px:2.25,minWidth:{xs:"auto",md:600}},maxWidth:x?{lg:680,xl:800}:680},children:[W&&e.jsx(Re,{alt:"attachment",src:t.body,onClick:()=>o(t.body)}),!!w&&e.jsx(e.Fragment,{children:J(t.body)}),!W&&!w&&e.jsx(e.Fragment,{children:j(t.body)}),t.attachments!==void 0&&t.attachments.length>0&&e.jsx(e.Fragment,{children:t.attachments.map((k,g)=>e.jsx(Re,{alt:"attachment",src:k.preview,onClick:()=>o(k.preview)},g))}),T&&!m&&c&&v(t.body)]})]})})]})}function Ln(t,n){let r="default";if(n!==t)r="default";else switch(n){case"Yes":r="success";break;case"No":r="error";break;default:r="default";break}return r}const Mn=L("div")(({theme:t})=>({margin:"auto",display:"flex",flexDirection:"column"})),Nn=L(St.h2)(({theme:t})=>({...vt(`300deg, #64B189 5%,
    #22A3E7 20%,
    #DA57A5 50%,
    #F79D5D 60%,
    #ED6D1E 80%`),backgroundSize:"200%",fontSize:`${42/16}rem`,textAlign:"center",lineHeight:1.25,marginBottom:20,letterSpacing:0,[t.breakpoints.up("md")]:{fontSize:`${50/16}rem`}}));function Is({title:t}){return e.jsx(Ae,{sx:{display:{md:"flex"}},children:e.jsx(Mn,{children:e.jsx(Nn,{animate:{backgroundPosition:"200% center"},children:t})})})}const Bn=L(R)(({theme:t})=>({height:2,borderRadius:0,paddingTop:t.spacing(1),paddingLeft:t.spacing(0)}));function Ds({selected:t,title:n,prompt:r,onSelectQuery:o}){const[c,i]=u.useState(!1);return e.jsxs(K,{sx:{p:1,m:1,mb:1.5,mt:1.5,bgcolor:"background.neutral"},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(V,{size:"small",onClick:()=>i(s=>!s),children:e.jsx(ne,{icon:c?an:He,width:20})}),e.jsx(Bn,{onClick:()=>o(r),sx:{"&:hover":{backgroundColor:"transparent"},color:"text.primary"},children:e.jsx(z,{variant:"body2",fontWeight:600,textOverflow:"ellipsis",noWrap:!0,children:n})})]}),e.jsx(h,{sx:{mb:c?.5:0},children:e.jsx(kt,{in:c,children:e.jsx(l,{spacing:1,sx:{my:1},children:e.jsx(z,{variant:"body2",color:"text.primary",sx:{px:1,display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:5},children:r})})})})]})}const $e=["hybrid","text","vectors"],En=u.forwardRef(({chatMode:t,onClose:n,configs:r,onUpdate:o},c)=>{const i=It(Dt),s=i?i.map(a=>a.resourceName):[],d=re(!0),f=ln().shape({"open-chat-Deployment":xe().required("AOAI deployment is required"),"rag-Deployment":xe().required("AOAI deployment is required"),"function-calling-Deployment":xe().required("AOAI deployment is required")}),x=r,S=Object.keys(x),C=cn({resolver:dn(f),defaultValues:x}),{handleSubmit:D}=C,p=D(async a=>{try{o(a),n()}catch(m){console.error(m)}});return u.useImperativeHandle(c,()=>({submit:()=>p()})),e.jsx(hn,{methods:C,onSubmit:p,children:e.jsxs(h,{sx:{m:1.25,mt:1,mb:2},children:[e.jsx(h,{sx:{mb:3},children:e.jsx(z,{variant:"overline",sx:{ml:2,mb:4,color:"text.disabled"},children:"Azure OpenAI"})}),d.value&&e.jsx(l,{sx:{mx:2,mt:1,mb:3},spacing:3,children:e.jsx(h,{sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)",lg:"repeat(3, 1fr)"}},children:S.filter(a=>a.startsWith(t)).map(a=>a.includes("System message")?null:a.includes("Deployment")?e.jsx(Ce,{size:"small",name:a,label:"Deployment",options:s.map(m=>m),getOptionLabel:m=>m,renderOption:(m,W)=>{const{resourceName:b,primary:$}=i.filter(w=>w.resourceName===W)[0];return b?u.createElement("li",{...m,key:`${t}-${b}`},$&&e.jsx(y,{icon:"eva:star-fill",width:16,sx:{mr:1},color:"gray"},`${t}-${b}`),b):null}},a):a.includes("Retrieval mode")?e.jsx(Ce,{size:"small",name:a,label:a.replace(`${t}-`,""),options:$e,getOptionLabel:m=>m,renderOption:(m,W)=>{const b=$e.filter($=>$===W)[0];return b?u.createElement("li",{...m,key:`${t}-${b}`},b):null}},a):a.includes("Should stream")||a.includes("Use semantic")?e.jsx(on,{name:a,label:a.replace(`${t}-`,"")},a):e.jsx(xn,{name:a,label:a.replace(`${t}-`,""),fullWidth:!0,size:"small"},a))})}),!d.value&&e.jsx(N,{sx:{mx:2}})]})})}),Gn=En,Hn=L("div")(({theme:t})=>({right:0,bottom:0,zIndex:1999,minHeight:440,outline:"none",display:"flex",position:"fixed",flexDirection:"row",margin:t.spacing(3),boxShadow:t.customShadows.z20,borderRadius:t.shape.borderRadius,backgroundColor:t.palette.background.paper}));function Ws({open:t,chatMode:n,onClose:r,configurations:o,onUpdate:c}){const i=u.useRef(null),s=()=>{i.current&&i.current.submit(),r()};return e.jsx(Wt,{children:e.jsx(Be,{open:t,onClose:r,children:e.jsx(Hn,{sx:{top:0,left:0,display:"flex",margin:"auto",width:{xs:"90%",md:"85%",lg:"75%"},height:{xs:"90vh",md:"80vh"},maxWidth:1100},children:e.jsxs(l,{sx:{width:"100%"},children:[e.jsx(ge,{title:"Configuration",sx:{mb:1.5}}),e.jsx(B,{sx:{flexDirection:"row"},children:e.jsx(Gn,{onClose:()=>{},chatMode:n,configs:o,ref:i,onUpdate:c})}),e.jsx(N,{}),e.jsxs(Ee,{children:[e.jsx(R,{type:"submit",variant:"contained",onClick:s,children:"Confirm"}),e.jsx(R,{variant:"outlined",color:"inherit",onClick:r,children:"Cancel"})]})]})})})})}function Yn({title:t,subheader:n,chart:r,...o}){const{categories:c,colors:i,series:s,options:d}=r,f=ee(),x=ue(),[S,C]=u.useState("Total Sales"),D=Xe({colors:i,plotOptions:{bar:{columnWidth:"48%"}},stroke:{show:!0,width:3,colors:["transparent"]},xaxis:{categories:c},tooltip:{y:{formatter:a=>`$${a}`}},...d}),p=u.useCallback(a=>{x.onClose(),C(a)},[x]);return e.jsxs(e.Fragment,{children:[e.jsxs(Ge,{...o,sx:{mt:3,mb:2,width:"100%",boxShadow:"none",borderRadius:.75,border:`${Y(f.palette.grey[500],.12)} 1px solid`,bgcolor:`${Y(f.palette.grey[500],.08)}`},children:[e.jsx(ge,{title:t,subheader:n,action:e.jsxs(Rt,{onClick:x.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[S,e.jsx(y,{width:16,icon:x.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),s.map((a,m)=>e.jsx(h,{sx:{mt:3,mb:m===0?-3:-1,mx:1.5},children:a.type===S&&e.jsx(Ze,{dir:"ltr",type:"bar",series:a.data,options:D,width:"100%",height:324})},a.type))]}),e.jsx(se,{open:x.open,onClose:x.onClose,sx:{width:140},children:s.map(a=>e.jsx(X,{selected:a.type===S,onClick:()=>p(a.type),children:a.type},a.type))})]})}function Un({title:t,subheader:n,chart:r,...o}){const c=ee(),{categories:i,series:s,options:d}=r,f=Xe({legend:{position:"top",horizontalAlign:"right"},xaxis:{categories:i},yaxis:{labels:{formatter:x=>Se(x)}},tooltip:{y:{formatter:x=>Se(x)}},...d});return e.jsxs(Ge,{...o,sx:{mt:3,mb:2,boxShadow:"none",borderRadius:.75,border:`${Y(c.palette.grey[500],.12)} 1px solid`,bgcolor:`${Y(c.palette.grey[500],.08)}`},children:[e.jsx(ge,{title:t}),e.jsx(h,{sx:{mt:3,mx:1.5},children:e.jsx(Ze,{dir:"ltr",type:"area",series:s,options:f,height:294})})]})}function qn({function_calls:t}){if(!t||t.length===0||!t[0].results)return null;const{funcName:n}=t[0];if(n==="get_stock_data"){const r=JSON.parse(t[0].results);if((Object.keys(r).includes("schema")?"curve":"")==="curve"){const i=r.title,s=r.data,d=s.map(p=>Ht(p.Date)),f=s.map(p=>p.Open),x=s.map(p=>p.Close),S=s.map(p=>p.Low),C=s.map(p=>p.High),D=s.map(p=>p["Adj Close"]);return e.jsx(Un,{title:i,subheader:"",chart:{categories:d,series:[{name:"Open",data:f},{name:"Close",data:x},{name:"Low",data:S},{name:"High",data:C},{name:"Adj Close",data:D}]}})}}else if(n==="get_sales_data"){const r=JSON.parse(t[0].results);return e.jsx(Yn,{title:"YoY Statistics",subheader:"",chart:r})}return null}const Vn=["jpg","gif","png","gif","bmp","svg","webp"],Jn=new RegExp(`https.*\\.(${Vn.join("|")}).*(?=\\))`,"i"),Kn=L("div")(({theme:t})=>({display:"flex",marginBottom:t.spacing(3)})),Qn=L("div")(({theme:t})=>({maxWidth:680,fontSize:13,padding:t.spacing(0,1.5,0,1.5),marginTop:t.spacing(.5),borderRadius:6,backgroundColor:t.palette.background.paper})),Xn=L(z)(({theme:t})=>({display:"flex",marginBottom:t.spacing(.75),color:t.palette.text.secondary})),Te=L("img")(({theme:t})=>({width:"100%",cursor:"pointer",objectFit:"cover",borderRadius:6,marginBottom:t.spacing(1.5),[t.breakpoints.up("md")]:{height:240,minWidth:296}})),Zn=t=>{let n=t;return t.startsWith("<")&&(n=n.slice(1)),t.endsWith(">")&&(n=n.slice(0,-1)),n};function Rs({message:t,avatarUrl:n,participants:r,isLastMessage:o,onOpenLightbox:c,onOpenRagSourcePanel:i}){const s=ee(),d=_e("up","sm"),x=me().themeStretch,S=et(t.thoughts),C=r.find(j=>j.id===t.senderId),p=(t.senderId==="user"?{type:"me"}:{avatar:C==null?void 0:C.avatarUrl,name:C==null?void 0:C.name}).type==="me",a=t.contentType==="image",m=!!t.function_calls&&t.function_calls.length>0&&!!t.function_calls[0].results&&(t.function_calls[0].funcName.includes("sales")||t.function_calls[0].funcName.includes("stock")),W=t.body?t.body.match(/\/(.*\.mp4)/):null,b=W?`/${W[1]}`:"",$=t.body?t.body.match(Jn):null,w=$?$[0]:"",E=tt(new Date(t.createdAt),{addSuffix:!0}),_=t&&t.body&&(t.body.startsWith("(SYS)Working")||t.body.startsWith("(SYS)function")),F=j=>{try{if(_)return null;let v=j;return w.length>0&&(v.includes("](http")&&!v.includes("![")&&(v=v.replace("[","![")),v.endsWith(")。")&&(v=v.replace(")。",")"))),e.jsxs(h,{onClick:()=>{w.length>0&&c(w)},children:[p&&e.jsx(h,{sx:{py:1,wordBreak:"break-word",whiteSpace:"pre-line"},children:v}),!p&&e.jsx(q,{sx:{"& p":{fontSize:15},"& .component-image":{my:0,borderRadius:1},"& a":{wordBreak:"break-all"},"& code":{wordBreak:"break-word",whiteSpace:"pre-wrap"},"& pre, & pre > code":{py:1,fontSize:13,lineHeight:1.75},...!d&&{"& pre, & pre > code":{fontSize:13,py:1,lineHeight:1.5,whiteSpace:"pre-wrap"}}},children:v})]})}catch{return e.jsx(h,{sx:{typography:"body2"},children:j.replace("<eos>","")})}},T=j=>{try{return _?null:e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsx(q,{children:j.replace("<eos>","")})}),e.jsx(h,{sx:{py:1.5},children:e.jsx(K,{sx:{pb:2,pt:2.9,display:"flex",alignItems:"center",borderRadius:"5px",backgroundColor:`${s.palette.grey[900]}`},children:e.jsx(qe,{url:b,width:"100%",height:"100%",playIcon:e.jsx(ne,{icon:Ve,width:36,height:36}),controls:!0})})})]})}catch{return e.jsx(h,{sx:{typography:"body2"},children:j.replace("<eos>","")})}},U=j=>{try{return e.jsxs(e.Fragment,{children:[F(j),!p&&e.jsx(qn,{function_calls:t.function_calls||[]}),j&&J()]})}catch{return e.jsxs(e.Fragment,{children:[j?e.jsx(h,{sx:{typography:"body2"},children:j}):F("Nothing to display"),j&&J()]})}},Q=j=>{if(j.startsWith("(SYS)function")){const v=t.body.split(":")[1].trim(),M=j.includes("calling")?"running":"executed";return e.jsxs(l,{children:[e.jsxs(l,{direction:"row",alignItems:"center",spacing:1.5,sx:{width:"100%"},children:[e.jsx(y,{icon:M==="running"?ae:le,sx:{ml:-.5,height:24,width:24,color:`${s.palette.primary.main}`}}),e.jsxs(h,{children:[M==="running"&&e.jsxs(l,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(h,{sx:{fontSize:14,py:1},children:"Calling: "}),e.jsx(q,{sx:{transform:"translateY(-1px)"},children:`\`${v}\``})]}),M==="executed"&&e.jsx(l,{direction:"row",alignItems:"center",spacing:1,children:e.jsx(h,{sx:{fontSize:14,py:1},children:"Keep working ..."})}),e.jsx(ce,{color:"primary",sx:{mt:0,mb:1.5}})]})]}),M==="executed"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{sx:{mt:.5,borderStyle:"dashed"}}),e.jsx(l,{spacing:0,sx:{my:1},children:e.jsxs(l,{direction:"row",alignItems:"center",spacing:2,sx:{my:-.5},children:[e.jsx(y,{icon:Je,sx:{ml:-.05,height:17,width:17,transform:"translateY(1.5px)",color:`${s.palette.success.main}`}}),e.jsx(q,{sx:{"& code":{fontSize:12,borderRadius:.5}},children:`\`${v}\``}),e.jsx(h,{sx:{fontSize:13,py:1,ml:-1.25,transform:"translateY(0.5px)"},children:"executed"}),e.jsx(V,{size:"small",onClick:()=>{},sx:{ml:-1,transform:"translateY(1.5px)"},children:e.jsx(y,{icon:Ke,sx:{height:16,width:16,color:`${s.palette.text.secondary}`}})})]})})]})]})}return j.startsWith("(SYS)Working on it")?e.jsxs(l,{direction:"row",alignItems:"center",spacing:1.5,children:[e.jsx(y,{icon:le,sx:{ml:-.5,height:24,width:24,color:`${s.palette.primary.main}`}}),e.jsxs(h,{children:[e.jsx(h,{sx:{fontSize:14,py:1},children:"Working on it"}),e.jsx(ce,{color:"primary",sx:{mt:0,mb:1.5}})]})]}):null},J=()=>t&&t.body&&!p&&!_&&e.jsxs(e.Fragment,{children:[(t.thoughts&&t.thoughts.length>2||t.sources&&t.sources.length>0||t.function_calls&&t.function_calls.length>0)&&e.jsx(N,{sx:{borderStyle:"dashed",mb:.75,mt:1.5}}),e.jsxs(l,{spacing:1,direction:"row",alignItems:"center",sx:{pb:.75,maxWidth:"100%",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:[t.thoughts&&t.thoughts.length>2&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{sx:{px:0,py:0,width:72,fontSize:"12px",fontWeight:600,color:"text.secondary"},onClick:()=>i(t.thoughts,"All"),children:["Sources (",S.length,")"]}),e.jsx(B,{sx:{flexGrow:1,maxWidth:1},children:e.jsx(l,{display:"flex",spacing:1,direction:"row",children:S.length>0&&S.map((j,v)=>e.jsx(h,{children:e.jsx(R,{variant:"soft",color:"info",size:"medium",startIcon:e.jsx(y,{icon:"codicon:book",sx:{height:14,mx:-.5}}),sx:{pl:1.25,pr:.75,height:24,fontSize:"12px",fontWeight:400,overflow:"auto",textTransform:"none",textOverflow:"ellipsis",whiteSpace:"noWrap",borderRadius:.5,justifyContent:"flex-start",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},onClick:()=>{i(t.thoughts,j)},children:j})},v))})})]}),t.sources&&t.sources.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"caption",sx:{fontWeight:600,minWidth:80},children:["Sources (",t.sources.length,")"]}),e.jsx(B,{sx:{flexGrow:1,maxWidth:"99%"},children:e.jsx(l,{display:"flex",spacing:1,direction:"row",children:t.sources.map((j,v)=>e.jsx(h,{children:e.jsx(R,{href:Zn(j.url),target:"_blank",variant:"soft",color:"info",size:"medium",startIcon:e.jsx(y,{icon:Qe,sx:{height:14,mx:-.5}}),sx:{px:1.25,height:24,fontSize:"12px",fontWeight:400,maxWidth:140,overflow:"auto",textTransform:"none",textOverflow:"ellipsis",whiteSpace:"noWrap",borderRadius:.5,justifyContent:"flex-start"},children:j.label})},v))})})]}),t.function_calls&&t.function_calls.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"caption",sx:{fontWeight:600,minWidth:80,color:"text.secondary"},children:["Function calls (",t.function_calls.length,")"]}),e.jsx(B,{sx:{flexGrow:1,maxWidth:"99%"},children:e.jsx(l,{display:"flex",spacing:1,direction:"row",children:t.function_calls.map((j,v)=>e.jsx(h,{children:e.jsx(R,{variant:"soft",color:"warning",size:"medium",startIcon:e.jsx(y,{icon:ae,sx:{height:14,mx:-.5}}),sx:{px:1.25,height:24,fontSize:"12px",fontWeight:400,maxWidth:180,overflow:"auto",textTransform:"none",textOverflow:"ellipsis",whiteSpace:"noWrap",borderRadius:.5,justifyContent:"flex-start"},children:j.funcName})},v))})})]})]})]});return e.jsxs(Kn,{children:[!p&&e.jsx(Z,{alt:"copilot",src:n,sx:{width:30,height:30,mr:1.25}}),e.jsx(h,{sx:{display:"flex",...p&&{ml:"auto"}},children:e.jsxs("div",{children:[e.jsx(Xn,{variant:"caption",sx:{...p&&{justifyContent:"flex-end"}},children:E.startsWith("0 sec")?"Just now":E}),e.jsxs(Qn,{sx:{typography:"body2",bgcolor:"background.neutral",...p&&{color:"grey.800",bgcolor:"#d5f6fe"},...a&&{p:1},...!p&&t.body&&!_&&{pt:.05,px:1.5,minWidth:{xs:"auto",md:m?600:400}},...m&&{pt:.75,px:2.25,minWidth:{xs:"auto",md:600}},maxWidth:x?{lg:340,xl:400}:320},children:[a&&e.jsx(Te,{alt:"attachment",src:t.body,onClick:()=>c(t.body)}),!!b&&e.jsx(e.Fragment,{children:T(t.body)}),!a&&!b&&e.jsx(e.Fragment,{children:U(t.body)}),t.attachments!==void 0&&t.attachments.length>0&&e.jsx(e.Fragment,{children:t.attachments.map((j,v)=>e.jsx(Te,{alt:"attachment",src:j.preview,onClick:()=>c(j.preview)},v))}),_&&!p&&o&&Q(t.body)]})]})})]})}export{vs as C,Ws as D,Rs as a,Is as b,ks as c,Ds as d};

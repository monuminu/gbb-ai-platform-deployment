import{u as R}from"./index-8fda52a8.js";import{aK as W,r as x,ad as u,aL as p,a5 as U,j as e,n as L,h as C,o as H,T as c,ar as I,s as j,B as S,S as w,N as F,m as O,P as N,D as z}from"./index-f7c4dfad.js";import{E as K}from"./image-f9ea5de7.js";import{F as E,b as P,c as V,e as Q,T as $,d as Y,a as B}from"./file-thumbnail-ebe9c7d7.js";import{n as M,L as A,C as q}from"./numeral-b65a1435.js";import{_ as G}from"./arrow-ios-forward-fill-2d56b1a6.js";import{M as X}from"./markdown-e1ecb202.js";import{L as _}from"./use-light-box-1c577ab5.js";import{T as Z,a as J}from"./Tabs-e58d3a15.js";import{D as ee,a as te}from"./DialogContent-12fa3194.js";function Re(t){const i=p.kmm.list,{data:a,isLoading:r,error:n,isValidating:l}=R([i,t],W);return x.useMemo(()=>({kmmList:a||[],isLoading:r,hasError:n,isValidating:l,isEmpty:!a||!r&&!a.length}),[a,n,r,l])}function We(t,i){const a=t?`${p.kmm.root}/${t}`:"",{data:r,isLoading:n,error:l,isValidating:o}=R([a,i],W);return x.useMemo(()=>({kbMeta:r||null,isLoading:n,hasError:l,isValidating:o}),[r,l,n,o])}function Le(t,i){const a=t?`${p.kmm.root}/${t}/items`:"",{data:r,isLoading:n,error:l,isValidating:o}=R([a,i],W);return x.useMemo(()=>({kbItems:r||[],isLoading:n,hasError:l,isValidating:o}),[r,l,n,o])}async function ze(t,i){const a=i?`${p.kmm.root}/${t}/items/${i}`:"";try{const r=await u.get(a);return r.status===200?r.data:null}catch{return null}}async function $e(t,i){const a=t?`${p.kmm.kb}/${t}/upload`:"";try{const r=await u.post(a,i);return r.status===200?r.data:r}catch(r){return r}}async function Me(t){const i=p.kmm.create;try{const a=await u.post(i,t);return a.status===200?a.data:null}catch(a){return a}}async function Ae(t,i){const a=t?`${p.kmm.root}/delete`:"";try{const r=await u.post(a,{kbId:t,indexName:i});return r.status===200?r.data:null}catch(r){return r}}async function _e(t,i,a){const r=t&&i?`${p.kmm.kb}/${t}/index/${i}`:"";try{const n=await u.post(r,a);return n.status===200?n.data:null}catch(n){return n}}async function De(t){const i=p.kmm.sources;try{const a=await u.post(i,t);return a.status===200?a.data:null}catch(a){return a}}const ae={width:20,height:20,body:'<path fill="currentColor" d="M5.8 12.2V6H2C.9 6 0 6.9 0 8v6c0 1.1.9 2 2 2h1v3l3-3h5c1.1 0 2-.9 2-2v-1.82a.943.943 0 0 1-.2.021h-7V12.2zM18 1H9c-1.1 0-2 .9-2 2v8h7l3 3v-3h1c1.1 0 2-.899 2-2V3c0-1.1-.9-2-2-2z"/>'};var Ee=ae;const ie={width:24,height:24,body:'<path fill="currentColor" d="M12 1.772a2.045 2.045 0 1 0 0 4.09a2.045 2.045 0 0 0 0-4.09zM7.364 5.453a2.047 2.047 0 0 0 0 4.092a2.045 2.045 0 0 0 0-4.092zm9.273 0a2.047 2.047 0 0 0 0 4.092a2.045 2.045 0 0 0 0-4.092zM1.347 7.637a1.318 1.318 0 0 0-.93.36a1.325 1.325 0 0 0-.145 1.769c.66.864 1.993 2.604 2.652 3.465a5.401 5.401 0 0 1 1.112 3.283c0 1.519.71 2.966 1.949 3.841a10.27 10.27 0 0 0 2.515 1.3v-3.933c0-.592.191-1.17.472-1.652a4.152 4.152 0 0 0-1.198-2.496L2.342 8.106a1.369 1.369 0 0 0-.996-.47zm21.31 0a1.318 1.318 0 0 0-.917.39l-4.545 4.575l-.968.974a4.161 4.161 0 0 0-1.199 2.494c.265.455.454.993.472 1.549v4.039a10.28 10.28 0 0 0 2.516-1.303c1.238-.875 1.949-2.323 1.949-3.842a5.412 5.412 0 0 1 1.111-3.285l2.652-3.462a1.327 1.327 0 0 0-.144-1.77a1.314 1.314 0 0 0-.928-.36zM12 9.135a2.047 2.047 0 0 0 0 4.091a2.045 2.045 0 0 0 0-4.091zm.002 5.728c-1.658 0-3.002 1.28-3.002 2.86v4.091a11.075 11.075 0 0 0 6 0v-4.18c-.049-1.538-1.371-2.77-2.998-2.77z"/>'};var Be=ie;const re={width:24,height:24,body:'<g id="evaArrowIosDownwardFill0"><g id="evaArrowIosDownwardFill1"><path id="evaArrowIosDownwardFill2" fill="currentColor" d="M12 16a1 1 0 0 1-.64-.23l-6-5a1 1 0 1 1 1.28-1.54L12 13.71l5.36-4.32a1 1 0 0 1 1.41.15a1 1 0 0 1-.14 1.46l-6 4.83A1 1 0 0 1 12 16Z"/></g></g>'};var ne=re;const se=j(S)(({theme:t})=>({width:"100%",height:24,borderRadius:0,overflowY:"hidden",paddingLeft:t.spacing(.5)})),g=j(w)(({theme:t})=>({alignItems:"center",flexShrink:0,paddingY:t.spacing(1),paddingLeft:t.spacing(.25),paddingRight:t.spacing(1.5),borderRight:`1.5px solid ${F(t.palette.text.disabled,.58)}`}));function oe({chunk:t,expanded:i,onExpanded:a,maxSearchScore:r,maxRerankerScore:n}){const l=U("up","sm"),[o,h]=x.useState("Preview"),{content:m,category:d,sourcepage:s,sourcefile:y,search_score:f,search_reranker_score:v}=t;return e.jsxs(L,{sx:{p:1,mx:3.25,mb:1.5,mt:0,bgcolor:"background.neutral"},children:[e.jsx(C,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"center"},children:e.jsxs(se,{onClick:a,startIcon:e.jsx(H,{icon:i?ne:G,width:16,height:16}),sx:{justifyContent:"flex-start","&:hover":{backgroundColor:"transparent"},color:"text.primary",overflowX:"auto",whiteSpace:"nowrap",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:[v&&e.jsxs(g,{direction:"row",spacing:1,children:[e.jsx(_,{value:Math.floor(v/n*100),variant:"determinate",color:"primary",sx:{width:"60px",height:6}}),e.jsx(c,{variant:"caption",sx:{fontWeight:600},children:"Reranker score:"}),e.jsx(c,{variant:"caption",fontSize:"13px",sx:{width:36,textAlign:"left"},children:M(v).format("0.000")})]}),f&&e.jsxs(g,{direction:"row",spacing:1,sx:{ml:v?1.5:0},children:[e.jsx(_,{value:Math.floor(f/r*100),variant:"determinate",color:"warning",sx:{width:"60px",height:6}}),e.jsx(c,{variant:"caption",sx:{fontWeight:600},children:"Search score:"}),e.jsx(c,{variant:"caption",fontSize:"13px",sx:{width:42},children:M(f).format("0.0000")})]}),e.jsxs(g,{direction:"row",spacing:.75,sx:{ml:1.25},children:[e.jsx(c,{variant:"caption",sx:{flexShrink:0,fontWeight:600},children:"Source:"}),e.jsx(E,{file:y.toLowerCase()||"",sx:{width:18,height:18,py:0}}),e.jsx(c,{variant:"caption",fontSize:"13px",children:y})]}),e.jsxs(g,{direction:"row",spacing:.75,sx:{ml:1.25},children:[e.jsx(c,{variant:"caption",sx:{fontWeight:600},children:"Category:"}),e.jsx(c,{variant:"caption",fontSize:"13px",sx:{whiteSpace:"nowrap"},children:d})]}),e.jsxs(g,{direction:"row",spacing:.75,sx:{ml:1.25,borderRight:"none"},children:[e.jsx(c,{variant:"caption",sx:{fontWeight:600},children:"Page:"}),e.jsx(c,{variant:"caption",fontSize:"13px",children:s})]})]})}),e.jsx(C,{sx:{mb:i?.5:0},children:e.jsxs(I,{in:i,children:[e.jsx(Z,{value:o,allowScrollButtonsMobile:!0,onChange:(k,T)=>h(T),sx:{mt:.75,mb:2.25,mx:1.5,minHeight:38,justifyContent:"center"},children:["Preview","Raw"].map(k=>e.jsx(J,{disableRipple:!0,value:k,label:k,style:{marginRight:24,minWidth:20},sx:{mr:.25,minHeight:36}},k))}),e.jsxs(C,{sx:{my:1,mx:1.5},children:[o==="Raw"&&e.jsx(c,{variant:"body2",color:"text.primary",sx:{display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical"},children:m}),o==="Preview"&&e.jsx(X,{sx:{"& .component-image":{mt:1.5,borderRadius:1},"& code":{fontSize:"13px",wordBreak:"break-word",whiteSpace:"pre-wrap"},"& pre, & pre > code":{py:1,fontSize:"14px",lineHeight:1.5},...!l&&{"& pre, & pre > code":{py:1,lineHeight:1.5,whiteSpace:"pre-wrap"}},"& .MuiBox-root, p":{fontSize:"15px"},"& a":{}},children:m})]})]})})]})}function le({selected:t,ragThoughts:i}){const[a,r]=x.useState([]),n=i[2].description.filter(s=>t==="All"||s.sourcefile===t),l=Math.max(...n.map(s=>s.search_reranker_score)),o=Math.max(...n.map(s=>s.search_score)),h=x.useCallback(s=>{const y=a.includes(s)?a.filter(f=>f!==s):[...a,s];r(y)},[a]),m=x.useCallback(s=>{r(s)},[]),d=x.useCallback(()=>{r([])},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(w,{direction:"row",alignItems:"center",sx:{mx:3.25,mb:1.5},children:[e.jsx(S,{variant:"text",sx:{py:.25,px:.5,fontSize:"12px",fontWeight:600,color:"text.secondary"},onClick:()=>m(n.map(s=>s.id)),children:"Expand all"}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mx:.5},children:"|"}),e.jsx(S,{sx:{py:.25,px:.5,fontSize:"12px",fontWeight:600,color:"text.secondary"},onClick:()=>d(),children:"Collapse all"})]}),e.jsx(O,{sx:{flexDirection:"row"},children:n.map(s=>e.jsx(oe,{expanded:a.includes(s.id),chunk:s,onExpanded:()=>h(s.id),maxRerankerScore:l,maxSearchScore:o},s.id))})]})}const ce=[{id:"originalQuery",label:"Original query",width:160,minWidth:140,maxWidth:200},{id:"generatedQuery",label:"Generated search query",width:160,minWidth:140,maxWidth:200},{id:"retrievalMode",label:"Retrieval mode",width:100,minWidth:60,maxWidth:140},{id:"useSemanticRanker",label:"Use semantic ranker",width:110,minWidth:100,maxWidth:140},{id:"useSemanticCaption",label:"Use semantic caption",width:110,minWidth:80,maxWidth:140}],de=j(B)(({theme:t})=>({fontSize:"13px",fontWeight:"600",color:t.palette.text.secondary,paddingLeft:t.spacing(1),paddingTop:t.spacing(.25),paddingBottom:t.spacing(1),backgroundColor:"transparent","&::after":{borderBottom:"none"}})),b=j(B)(({theme:t})=>({paddingLeft:t.spacing(1),paddingTop:t.spacing(.25),paddingBottom:t.spacing(0)}));function xe({originalQuery:t,generatedQuery:i,searchProps:a}){const r=a?a.retrieval_mode:"N/A",n=a?a.use_semantic_ranker:"N/A",l=a?a.use_semantic_captions:"N/A";return e.jsx(L,{sx:{mx:3.25,mt:2.5,pt:.5,pb:1,bgcolor:"background.neutral"},children:e.jsx(P,{sx:{overflowY:"hidden",py:.5},children:e.jsxs(V,{children:[e.jsx(Q,{children:e.jsx($,{children:ce.map(o=>e.jsx(de,{align:o.id==="activity"?"center":"left",sx:{width:o.width,minWidth:o.minWidth,maxWidth:o.maxWidth,pl:2.25},children:o.label},o.id))})}),e.jsx(Y,{children:e.jsxs($,{children:[e.jsx(b,{align:"left",sx:{px:2.5,color:"text.primary",maxWidth:380},children:e.jsx(c,{variant:"body2",sx:{display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:t||"N/A"})}),e.jsx(b,{align:"left",sx:{px:2.25,color:"text.primary",maxWidth:380},children:e.jsx(c,{variant:"body2",sx:{display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:i||"N/A"})}),e.jsx(b,{align:"left",sx:{pl:2.25},children:e.jsx(c,{variant:"body2",sx:{display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:r||"N/A"})}),e.jsx(b,{align:"left",sx:{pl:2.25},children:e.jsx(A,{variant:"soft",color:D(n),children:n.toString()})}),e.jsx(b,{align:"left",sx:{pl:2.25},children:e.jsx(A,{variant:"soft",color:D(l),children:l.toString()})})]})})]})})})}function D(t){let i="default";switch(t){case!0:i="success";break;case!1:i="error";break;default:i="default";break}return i}const pe=j("div")(({theme:t})=>({right:0,bottom:0,zIndex:1999,minHeight:440,outline:"none",display:"flex",position:"fixed",flexDirection:"row",margin:t.spacing(3),boxShadow:t.customShadows.z20,borderRadius:t.shape.borderRadius,backgroundColor:t.palette.background.paper}));function Te({open:t,onClose:i,ragThoughts:a,selectedSource:r}){const[n,l]=x.useState(r),o=he(a);x.useEffect(()=>{l(r)},[r]);const h=x.useCallback(d=>{n!==d&&l(d)},[n]),m=["All",...o].map(d=>e.jsxs(w,{spacing:1,component:L,variant:"outlined",direction:"row",alignItems:"center",onClick:()=>h(d),sx:{px:1.75,py:.5,borderRadius:20,cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",border:s=>`1px solid ${s.palette.divider}`,...d===n&&{border:s=>`1px solid ${s.palette.info.dark}`,boxShadow:s=>`inset 0 0 0 1px ${s.palette.info.dark}`}},children:[d!=="All"&&e.jsx(E,{file:d.toLowerCase()||"",sx:{width:18,height:18,my:"3px"}}),e.jsx(c,{variant:"subtitle2",fontSize:"13px",lineHeight:1,children:`${me(d,24)} (${ue(a,d)})`})]},d));return e.jsx(N,{children:e.jsx(ee,{open:t,onClose:i,children:e.jsxs(pe,{sx:{top:0,left:0,display:"flex",margin:"auto",width:{xs:"90%",md:"90%",lg:"90%"},height:{xs:"90vh",md:"90"}},children:[(!a||a.length<3)&&e.jsx(K,{filled:!0,title:"No sources",sx:{py:12,width:"100%"},imgUrl:"/assets/icons/empty/ic_analysis.svg"}),a&&a.length>2&&e.jsxs(w,{sx:{width:"100%"},children:[e.jsx(q,{title:"Sources",sx:{mb:2,pt:2}}),e.jsx(z,{}),e.jsx(xe,{originalQuery:a[0].description,generatedQuery:a[1].description,searchProps:a[1].props}),e.jsx(w,{direction:"row",spacing:1.5,sx:{mx:3.25,mt:3,mb:1.5,flexWrap:"wrap",justifyContent:"flex-start"},children:m}),e.jsx(le,{selected:n,ragThoughts:a}),e.jsx(z,{}),e.jsx(te,{sx:{py:2},children:e.jsx(S,{size:"medium",variant:"outlined",color:"inherit",onClick:i,children:"Cancel"})})]})]})})})}function he(t){return!t||t.length<3?[]:[...new Set(t[2].description.map(i=>i.sourcefile))]}function me(t,i){return t.length>i?`${t.slice(0,i)}...`:t}function ue(t,i){return!t||t.length<3?[]:t[2].description.filter(r=>i==="All"||r.sourcefile===i).length}export{Te as R,Ee as _,Be as a,ne as b,Me as c,Ae as d,Le as e,$e as f,ze as g,We as h,_e as i,he as j,De as k,Re as u};

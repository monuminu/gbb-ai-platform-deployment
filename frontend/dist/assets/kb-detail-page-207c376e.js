import{j as e,a as M,r as m,S as c,T as B,h as F,d as K,z as ke,m as de,D as he,I as y,c as Te,A as xe,s as Se,B as P,b as te,C as ne,N as we,i as pe,M as se,l as me,f as be,n as Qe,e as Ze,v as Ie,k as Ve,u as Xe,W as es,w as ss,o as ts,p as ns}from"./index-f7c4dfad.js";import{L as J,_ as as}from"./plus-fill-f9c9dd5d.js";import{G as $,D as De,f as is,L as rs,u as os,_ as ls}from"./tool-f255544f.js";import{u as cs}from"./use-params-075b74e1.js";import{_ as ds,a as hs,b as xs,g as ps,i as ms,e as us,f as gs,h as js}from"./rag-source-dialog-bf54fa9f.js";import{b as ue,A as We,C as H,D as Ae,c as Re,a as Fe}from"./DialogContent-12fa3194.js";import{S as q}from"./index-8fda52a8.js";import{C as fs}from"./custom-breadcrumbs-4cb50d46.js";import{a as ws,_ as bs}from"./sidebar-close-69a0d336.js";import{b as Pe,c as Cs,C as ze,a as Le,f as ee}from"./confirm-dialog-e205398d.js";import{_ as _e}from"./cloud-upload-fill-a41285d1.js";import{g as ge,F as ae,b as Me,c as Be,e as ys,T as le,d as $e,f as vs,a as E}from"./file-thumbnail-ebe9c7d7.js";import{b as ks,F as Ts,C as Ce,u as Ss,a as Is}from"./file-manager-copilot-ead7248d.js";import{T as Q,L as Ds}from"./TextField-5cd6dfc4.js";import{A as Ee}from"./AvatarGroup-b5aeb853.js";import{T as Ws,g as As}from"./user-ea221cef.js";import{_ as Rs,C as Fs,s as Ps,T as zs,a as Ls,e as _s,b as Ms,c as Bs,u as $s,g as Es}from"./custom-date-range-picker-998109e2.js";import{U as Us}from"./upload-1fbeb8f8.js";import"./image-f9ea5de7.js";import{I as Ue,L as ye}from"./numeral-b65a1435.js";import{S as Os}from"./knowledge-9078246a.js";import{_ as Ks}from"./more-horizontal-fill-3cef82a0.js";import{f as Oe}from"./format-number-ad5a4a25.js";import"./arrow-ios-forward-fill-2d56b1a6.js";import"./markdown-e1ecb202.js";import"./use-light-box-1c577ab5.js";import"./Tabs-e58d3a15.js";import"./use-get-message-377020ea.js";import"./api-c77678a4.js";import"./use-messages-scroll-6244af21.js";import"./preview-multi-file-bce21d5d.js";import"./fade-295cf198.js";import"./transition-bee6630b.js";import"./coming-soon-image-464dfa9d.js";function ce({rowNumber:s=7,sx:r}){return e.jsx(ue,{sx:{...r,px:2.5,py:4},children:e.jsxs($,{container:!0,spacing:3,children:[e.jsx($,{item:!0,xs:1,md:1,lg:1,children:[...Array(s)].map((h,t)=>e.jsx(q,{variant:"circular",width:40,height:40,sx:{mb:t===s-1?0:3}},`a${t}`))}),e.jsx($,{item:!0,xs:6,md:6,lg:6,sx:{ml:-2},children:[...Array(s)].map((h,t)=>e.jsx(q,{variant:"rectangular",width:"100%",height:40,sx:{mb:t===s-1?0:3,borderRadius:1}},`b${t}`))}),e.jsx($,{item:!0,xs:4,md:4,lg:4,children:[...Array(s)].map((h,t)=>e.jsx(q,{variant:"rectangular",width:"100%",height:40,sx:{mb:t===s-1?0:3,borderRadius:1}},`c${t}`))}),e.jsx($,{item:!0,xs:1,md:1,lg:1,children:[...Array(s)].map((h,t)=>e.jsx(q,{variant:"rectangular",width:"100%",height:40,sx:{mb:t===s-1?0:3,borderRadius:1}},`d${t}`))})]})})}function Ns({item:s,open:r,onClose:h,onDelete:t,...i}){const{name:a,type:o,index:v,shared:p,modifiedAt:j}=s,n=p&&!!p.length,x=M(),g=M(!0),A=M(!0),[w,S]=m.useState(""),[T,I]=m.useState(s.tags.slice(0,3)),W=m.useCallback(d=>{S(d.target.value)},[]),L=m.useCallback(d=>{I(d)},[]),_=e.jsxs(c,{spacing:1.5,children:[e.jsx(B,{variant:"subtitle2",children:"Tags"}),g.value&&e.jsx(We,{multiple:!0,freeSolo:!0,options:s.tags.map(d=>d),getOptionLabel:d=>d,defaultValue:s.tags.slice(0,3),value:T,onChange:(d,D)=>{L(D)},renderOption:(d,D)=>m.createElement("li",{...d,key:D},D),renderTags:(d,D)=>d.map((f,b)=>m.createElement(H,{...D({index:b}),size:"small",variant:"soft",label:f,key:f})),renderInput:d=>e.jsx(Q,{...d,placeholder:"Add tags"})})]}),u=e.jsxs(c,{spacing:1.5,children:[e.jsx(B,{variant:"subtitle2",children:"Properties"}),A.value&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{direction:"row",sx:{typography:"caption",textTransform:"capitalize"},children:[e.jsx(F,{component:"span",sx:{width:60,minWidth:60,color:"text.secondary",mr:1},children:"Modified"}),Pe(j)]}),e.jsxs(c,{direction:"row",sx:{typography:"caption",textTransform:"capitalize"},children:[e.jsx(F,{component:"span",sx:{width:60,minWidth:60,color:"text.secondary",mr:1},children:"Type"}),ge(o)]}),e.jsxs(c,{direction:"row",sx:{typography:"caption",textTransform:"none",wordBreak:"break-all"},children:[e.jsx(F,{component:"span",sx:{width:60,minWidth:60,color:"text.secondary",mr:1},children:"Index"}),v||"N / A"]})]})]}),C=e.jsxs(e.Fragment,{children:[e.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{p:2.5,py:1.5},children:[e.jsx(B,{variant:"subtitle2",textTransform:"capitalize",children:"Manage Access"}),e.jsx(K,{size:"small",onClick:x.onTrue,sx:{p:.25},children:e.jsx(F,{component:"img",src:"/assets/icons/modules/ic_manage_access.svg",sx:{width:26,height:26,cursor:"pointer"}})})]}),n&&e.jsx(F,{sx:{pl:2.5,pr:1},children:p.map(d=>e.jsx(ks,{person:d},d.id))})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{open:r,onClose:h,anchor:"right",slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:320}},...i,children:[e.jsxs(de,{sx:{height:1},children:[e.jsxs(c,{spacing:2.5,justifyContent:"center",sx:{p:2.5,bgcolor:"background.neutral"},children:[e.jsxs(c,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(ae,{file:"folder",sx:{width:27,height:27}}),e.jsx(B,{variant:"subtitle1",sx:{wordBreak:"break-all"},children:a})]}),e.jsx(he,{sx:{borderStyle:"dashed"}}),_,u]}),C]}),e.jsxs(c,{sx:{p:2},direction:"row",spacing:1.5,children:[e.jsx(J,{fullWidth:!0,loading:!1,variant:"soft",color:"success",size:"medium",startIcon:e.jsx(y,{icon:_e}),onClick:()=>{},sx:{height:38},children:"Update"}),e.jsx(J,{fullWidth:!0,variant:"soft",color:"error",size:"medium",startIcon:e.jsx(y,{icon:"gravity-ui:trash-bin",width:18}),onClick:()=>{},children:"Delete"})]})]}),e.jsx(Ts,{open:x.value,shared:p,inviteEmail:w,onChangeInvite:W,onCopyLink:()=>{},onClose:()=>{x.onFalse(),S("")}})]})}const Gs=[{id:"index",label:"Index",width:140,minWidth:100,maxWidth:200},{id:"type",label:"Type",width:140,minWidth:100,maxWidth:180},{id:"tags",label:"Tags",width:180,minWidth:140,maxWidth:240},{id:"createdAt",label:"Created",width:180,minWidth:160,maxWidth:220},{id:"modifiedAt",label:"Modified",width:140,minWidth:100,maxWidth:200},{id:"size",label:"Count",width:100,minWidth:80,maxWidth:120,align:"center"},{id:"shared",label:"Maintainers",width:140,minWidth:120,maxWidth:200,align:"right"},{id:"",width:80,minWidth:40,maxWidth:100}],Hs=Se(E)(({theme:s})=>({fontSize:"13px",fontWeight:"600",color:s.palette.text.secondary,paddingLeft:s.spacing(1),paddingTop:s.spacing(.5),paddingBottom:s.spacing(.5),"&::after":{borderBottom:"none"}})),N=Se(E)(({theme:s})=>({paddingLeft:s.spacing(1),paddingTop:s.spacing(.5),paddingBottom:s.spacing(.25)}));function qs({kb:s}){const{type:r,createdAt:h,index:t,modifiedAt:i,shared:a,tags:o,size:v}=s,p=M(),j=()=>{p.onTrue()};return e.jsxs(ue,{sx:{px:0,py:.75,mb:1},children:[e.jsx(Me,{sx:{overflowY:"hidden",py:.5},children:e.jsxs(Be,{children:[e.jsx(ys,{children:e.jsx(le,{children:Gs.map((n,x)=>e.jsx(Hs,{align:n.align?n.align:"left",sx:{width:n.width,minWidth:n.minWidth,maxWidth:n.maxWidth,pl:x===0?3:1},children:n.label},n.id))})}),e.jsx($e,{children:e.jsxs(le,{children:[e.jsx(N,{onClick:j,sx:{pl:3,color:"text.primary",whiteSpace:"nowrap",fontWeight:"600"},children:t||"N/A"}),e.jsx(N,{sx:{pl:1},children:!!r&&e.jsx(H,{size:"small",color:r.toLowerCase()==="qa"?"primary":"warning",variant:"soft",icon:e.jsx(y,{icon:r.toLowerCase()==="qa"?ds:hs,sx:{width:13,height:13}}),label:r===""?"QA":r,sx:{height:23,pl:.4,textTransform:"uppercase"}})}),e.jsx(N,{align:"left",onClick:j,sx:{color:"text.primary",whiteSpace:"nowrap",maxWidth:180},children:!!o&&e.jsx(c,{direction:"row",spacing:.5,children:o.map((n,x)=>e.jsx(H,{size:"small",color:"default",variant:"soft",label:n,sx:{height:23}},x))})}),e.jsx(N,{onClick:j,sx:{whiteSpace:"nowrap"},children:Cs(h)}),e.jsx(N,{align:"left",onClick:j,sx:{color:"text.primary",whiteSpace:"nowrap"},children:vs(new Date(i),{addSuffix:!0})}),e.jsx(N,{align:"center",onClick:j,sx:{color:"text.primary",whiteSpace:"nowrap"},children:v}),e.jsx(N,{align:"right",children:e.jsx(Ee,{max:4,sx:{display:"inline-flex",[`& .${Te.avatar}`]:{width:24,height:24,"&:first-of-type":{fontSize:12}}},children:a&&a.map(n=>e.jsx(xe,{alt:n.name,src:n.photo?n.photo:n.avatarUrl},n.id))})}),e.jsx(N,{align:"right",children:e.jsx(K,{onClick:j,children:e.jsx(y,{icon:ws,width:18,height:18})})})]})})]})}),e.jsx(Ns,{item:s,open:p.value,onClose:p.onFalse,onDelete:()=>{}})]})}function Ys({kbId:s,onUpload:r,title:h="Upload Files",open:t,onClose:i,onCreate:a,onUpdate:o,folderName:v,onChangeFolderName:p,...j}){const[n,x]=m.useState([]);m.useEffect(()=>{t||x([])},[t]);const g=m.useCallback(T=>{const I=T.map(W=>Object.assign(W,{preview:URL.createObjectURL(W)}));x([...n,...I])},[n]),A=()=>{i(),r(n)},w=T=>{const I=n.filter(W=>W!==T);x(I)},S=()=>{x([])};return e.jsxs(Ae,{fullWidth:!0,maxWidth:"sm",open:t,onClose:i,...j,children:[e.jsxs(De,{sx:{p:T=>T.spacing(3,3,2,3)},children:[" ",h," "]}),e.jsxs(Re,{dividers:!0,sx:{pt:1,pb:0,border:"none"},children:[(a||o)&&e.jsx(Q,{fullWidth:!0,label:"Folder name",value:v,onChange:p,sx:{mb:3}}),e.jsx(Us,{multiple:!0,files:n,onDrop:g,onRemove:w})]}),e.jsxs(Fe,{children:[e.jsx(P,{variant:"contained",startIcon:e.jsx(y,{icon:"eva:cloud-upload-fill"}),onClick:A,children:"Upload"}),!!n.length&&e.jsx(P,{variant:"outlined",color:"inherit",onClick:S,children:"Remove all"}),(a||o)&&e.jsx(c,{direction:"row",justifyContent:"flex-end",flexGrow:1,children:e.jsx(P,{variant:"soft",onClick:a||o,children:o?"Save":"Create"})})]})]})}const Js={width:24,height:24,body:'<g id="evaArrowIosUpwardFill0"><g id="evaArrowIosUpwardFill1"><path id="evaArrowIosUpwardFill2" fill="currentColor" d="M18 15a1 1 0 0 1-.64-.23L12 10.29l-5.37 4.32a1 1 0 0 1-1.41-.15a1 1 0 0 1 .15-1.41l6-4.83a1 1 0 0 1 1.27 0l6 5a1 1 0 0 1 .13 1.41A1 1 0 0 1 18 15Z"/></g></g>'};var Qs=Js;function Zs({openDateRange:s,onCloseDateRange:r,onOpenDateRange:h,filters:t,onFilters:i,dateError:a,typeOptions:o,statusOptions:v}){const p=te(),j=te(),n=m.useCallback(u=>{i("name",u.target.value)},[i]),x=m.useCallback(u=>{i("startDate",u)},[i]),g=m.useCallback(u=>{i("endDate",u)},[i]),A=m.useCallback(u=>{const C=t.types.includes(u)?t.types.filter(d=>d!==u):[...t.types,u];i("types",C)},[t.types,i]),w=m.useCallback(()=>{p.onClose(),i("types",[])},[i,p]),S=m.useCallback(u=>{const C=t.statuses.includes(u)?t.statuses.filter(d=>d!==u):[...t.statuses,u];i("statuses",C)},[t.statuses,i]),T=m.useCallback(()=>{j.onClose(),i("statuses",[])},[i,j]),I=e.jsx(Q,{size:"small",value:t.name,onChange:n,placeholder:"Search",InputProps:{startAdornment:e.jsx(Ue,{position:"start",children:e.jsx(y,{icon:Rs,sx:{color:"text.disabled"}})})},sx:{width:{xs:1,md:220}}}),W=e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"small",variant:"soft",color:"inherit",onClick:p.onOpen,endIcon:e.jsx(y,{icon:p.open?Qs:xs}),sx:{px:1.5,py:2,borderRadius:8},children:"Types"}),e.jsx(ne,{open:p.open,onClose:p.onClose,sx:{p:2.5},children:e.jsxs(c,{spacing:2.5,children:[e.jsx(F,{gap:1,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(4, 1fr)"},children:o.map(u=>{const C=t.types.includes(u);return e.jsx(Ce,{onClick:()=>A(u),sx:{p:1,borderRadius:1,cursor:"pointer",border:d=>`solid 1px ${we(d.palette.grey[500],.08)}`,...C&&{bgcolor:"action.selected"}},children:e.jsxs(c,{spacing:1.25,direction:"row",alignItems:"center",children:[e.jsx(ae,{file:u,sx:{width:22,height:22}}),e.jsx(B,{variant:C?"subtitle2":"body2",children:u})]})},u)})}),e.jsx(c,{spacing:1.5,direction:"row",alignItems:"center",justifyContent:"flex-end",children:e.jsx(P,{size:"small",variant:"contained",color:"inherit",onClick:w,children:"Clear"})})]})})]}),L=e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"small",variant:"soft",color:"inherit",onClick:j.onOpen,endIcon:e.jsx(y,{icon:j.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"}),sx:{px:1.5,py:2,borderRadius:8},children:"Status"}),e.jsx(ne,{open:j.open,onClose:j.onClose,sx:{p:2.5},children:e.jsxs(c,{spacing:2.5,children:[e.jsx(F,{gap:1,display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"repeat(4, 1fr)"},children:v.map(u=>{const C=t.statuses.includes(u);return e.jsx(Ce,{onClick:()=>S(u),sx:{p:1,borderRadius:1,cursor:"pointer",border:d=>`solid 1px ${we(d.palette.grey[500],.08)}`,...C&&{bgcolor:"action.selected"}},children:e.jsx(c,{spacing:1,direction:"row",alignItems:"center",children:e.jsx(B,{variant:C?"subtitle2":"body2",children:u})})},u)})}),e.jsx(c,{spacing:1.5,direction:"row",alignItems:"center",justifyContent:"flex-end",children:e.jsx(P,{size:"small",variant:"contained",color:"inherit",onClick:T,children:"Clear"})})]})})]}),_=e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"small",variant:"soft",color:"inherit",onClick:h,endIcon:e.jsx(y,{icon:s?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"}),sx:{px:1.5,py:2,borderRadius:8},children:"Created"}),e.jsx(Fs,{variant:"calendar",startDate:t.startDate,endDate:t.endDate,onChangeStartDate:x,onChangeEndDate:g,open:s,onClose:r,selected:!!t.startDate&&!!t.endDate,error:a})]});return e.jsxs(c,{spacing:2,justifyContent:"space-between",sx:{width:{xs:1,md:"auto"}},direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:[I,e.jsxs(c,{spacing:{xs:2,md:1},direction:"row",alignItems:"center",justifyContent:"flex-end",children:[_,W,L]})]})}function Ke({person:s}){const[r,h]=m.useState(s.permission),t=te(),i=m.useCallback(a=>{h(a)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(is,{sx:{px:0,py:1},children:[e.jsx(xe,{alt:s.name,src:s.avatarUrl,sx:{mr:2}}),e.jsx(rs,{primary:s.name,secondary:e.jsx(pe,{title:s.email,children:e.jsx("span",{children:s.email})}),primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span"},sx:{flexGrow:1,pr:1}}),e.jsxs(P,{size:"small",color:"inherit",endIcon:e.jsx(y,{width:20,icon:t.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:-1}}),onClick:t.onOpen,sx:{flexShrink:0,...t.open&&{bgcolor:"action.selected"}},children:["Can ",r]})]}),e.jsx(ne,{open:t.open,onClose:t.onClose,sx:{width:160},children:e.jsxs(e.Fragment,{children:[e.jsxs(se,{selected:r==="view",onClick:()=>{t.onClose(),i("view")},children:[e.jsx(y,{icon:"solar:eye-bold"}),"Can view"]}),e.jsxs(se,{selected:r==="edit",onClick:()=>{t.onClose(),i("edit")},children:[e.jsx(y,{icon:"solar:pen-bold"}),"Can edit"]}),e.jsx(he,{sx:{borderStyle:"dashed"}}),e.jsxs(se,{onClick:()=>{t.onClose()},sx:{color:"error.main"},children:[e.jsx(y,{icon:"gravity-ui:trash-bin",width:18}),"Remove"]})]})})]})}function Vs({shared:s,inviteEmail:r,onCopyLink:h,onChangeInvite:t,open:i,onClose:a,...o}){const v=s&&!!s.length;return e.jsxs(Ae,{fullWidth:!0,maxWidth:"xs",open:i,onClose:a,...o,children:[e.jsx(De,{children:" Invite "}),e.jsxs(Re,{sx:{overflow:"unset"},children:[t&&e.jsx(Q,{fullWidth:!0,value:r,placeholder:"Email",onChange:t,InputProps:{endAdornment:e.jsx(Ue,{position:"end",children:e.jsx(P,{color:"inherit",variant:"contained",disabled:!r,sx:{mr:-.75},children:"Send Invite"})})},sx:{mb:2}}),v&&e.jsx(de,{sx:{maxHeight:60*6},children:e.jsx(Ds,{disablePadding:!0,children:s.map(p=>e.jsx(Ke,{person:p},p.id))})})]}),e.jsxs(Fe,{sx:{justifyContent:"space-between"},children:[h&&e.jsx(P,{startIcon:e.jsx(y,{icon:"eva:link-2-fill"}),onClick:h,children:"Copy link"}),a&&e.jsx(P,{variant:"outlined",color:"inherit",onClick:a,children:"Close"})]})]})}function Xs({item:s,open:r,favorited:h,onFavorite:t,onCopyLink:i,onClose:a,onDelete:o,...v}){const{name:p,size:j,url:n,type:x,shared:g,modifiedAt:A}=s,w=g&&!!g.length,S=M(!0),T=M(),I=M(!0),[W,L]=m.useState(""),[_,u]=m.useState(s.tags.slice(0,3)),C=m.useCallback(l=>{L(l.target.value)},[]),d=m.useCallback(l=>{u(l)},[]),D=e.jsxs(c,{spacing:1.5,children:[e.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{typography:"subtitle2"},children:["Tags",e.jsx(K,{size:"small",onClick:S.onToggle,children:e.jsx(y,{icon:S.value?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"})})]}),S.value&&e.jsx(We,{multiple:!0,freeSolo:!0,options:s.tags.map(l=>l),getOptionLabel:l=>l,defaultValue:s.tags.slice(0,3),value:_,onChange:(l,R)=>{d(R)},renderOption:(l,R)=>m.createElement("li",{...l,key:R},R),renderTags:(l,R)=>l.map((z,G)=>m.createElement(H,{...R({index:G}),size:"small",variant:"soft",label:z,key:z})),renderInput:l=>e.jsx(Q,{...l,placeholder:"#Add a tags"})})]}),f=e.jsxs(c,{spacing:1.5,children:[e.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{typography:"subtitle2"},children:["Properties",e.jsx(K,{size:"small",onClick:I.onToggle,children:e.jsx(y,{icon:I.value?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"})})]}),I.value&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{direction:"row",sx:{typography:"caption",textTransform:"capitalize"},children:[e.jsx(F,{component:"span",sx:{width:80,color:"text.secondary",mr:2},children:"Size"}),Oe(j)]}),e.jsxs(c,{direction:"row",sx:{typography:"caption",textTransform:"capitalize"},children:[e.jsx(F,{component:"span",sx:{width:80,color:"text.secondary",mr:2},children:"Modified"}),Pe(A)]}),e.jsxs(c,{direction:"row",sx:{typography:"caption",textTransform:"capitalize"},children:[e.jsx(F,{component:"span",sx:{width:80,color:"text.secondary",mr:2},children:"Type"}),ge(x)]})]})]}),b=e.jsxs(e.Fragment,{children:[e.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{p:2.5},children:[e.jsx(B,{variant:"subtitle2",children:" File Share With "}),e.jsx(K,{size:"small",color:"primary",onClick:T.onTrue,sx:{width:24,height:24,bgcolor:"primary.main",color:"primary.contrastText","&:hover":{bgcolor:"primary.dark"}},children:e.jsx(y,{icon:"mingcute:add-line"})})]}),w&&e.jsx(F,{sx:{pl:2.5,pr:1},children:g.map(l=>e.jsx(Ke,{person:l},l.id))})]});return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{open:r,onClose:a,anchor:"right",slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:320}},...v,children:[e.jsxs(de,{sx:{height:1},children:[e.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{p:2.5},children:[e.jsx(B,{variant:"h6",children:" Info "}),e.jsx(ze,{color:"warning",icon:e.jsx(y,{icon:"eva:star-outline"}),checkedIcon:e.jsx(y,{icon:"eva:star-fill"}),checked:h,onChange:t})]}),e.jsxs(c,{spacing:2.5,justifyContent:"center",sx:{p:2.5,bgcolor:"background.neutral"},children:[e.jsx(ae,{file:x||n,sx:{width:48,height:48,ml:-.25},imgSx:{borderRadius:1}}),e.jsx(B,{variant:"subtitle1",sx:{wordBreak:"break-all"},children:p}),e.jsx(he,{sx:{borderStyle:"dashed"}}),D,f]}),b]}),e.jsxs(c,{sx:{p:2},direction:"row",spacing:1.5,children:[e.jsx(J,{fullWidth:!0,loading:!1,variant:"soft",color:"success",size:"medium",startIcon:e.jsx(y,{icon:_e}),onClick:()=>{},sx:{height:38},children:"Update"}),e.jsx(J,{fullWidth:!0,variant:"soft",color:"error",size:"medium",startIcon:e.jsx(y,{icon:"gravity-ui:trash-bin",width:18}),onClick:()=>{},children:"Delete"})]})]}),e.jsx(Vs,{open:T.value,shared:g,inviteEmail:W,onChangeInvite:C,onCopyLink:i,onClose:()=>{T.onFalse(),L("")}})]})}function et({kbId:s,row:r,dense:h,selected:t,onSelectRow:i,onDeleteRow:a,onUpdateRow:o}){const{id:v,name:p,size:j,type:n,chunks:x,modifiedAt:g,shared:A,status:w,isFavorited:S,error:T}=r,{enqueueSnackbar:I}=me(),{copy:W}=Ss(),L=M(S),_=M(),u=M(),C=te();m.useEffect(()=>{let b=null;return w&&!w.includes("loading")&&w.includes("ing")?(b=setInterval(()=>{w.includes("ing")?ps(s,v).then(l=>{l.status!==w&&o({...l}),l.status.includes("ing")||clearInterval(b)}).catch(l=>I(l,{variant:"error"})):clearInterval(b)},1e4),()=>clearInterval(b)):()=>clearInterval(b)},[w]);const d=()=>{},D=m.useCallback(()=>{I("Copied!"),W(r.url)},[W,I,r.url]);let f="default";return w.toLowerCase().startsWith("uploaded")?f="default":w.toLowerCase().startsWith("indexing")?f="secondary":w.toLowerCase().startsWith("indexed")?f="primary":w.toLowerCase().startsWith("uploading")||w.toLowerCase().startsWith("prep")?f="warning":w.toLowerCase().startsWith("failed")&&(f="error"),e.jsxs(e.Fragment,{children:[e.jsxs(le,{selected:t,children:[e.jsx(E,{sx:{pl:2,maxWidth:40,minWidth:40,...!h&&{py:1.25}},children:e.jsx(ze,{checked:t,onClick:i})}),e.jsx(E,{onClick:d,sx:{maxWidth:320,...!h&&{py:1.25}},children:e.jsxs(c,{direction:"row",alignItems:"center",spacing:1.25,children:[e.jsx(ae,{file:(n==null?void 0:n.toLowerCase())||"",sx:{width:24,height:24}}),e.jsx(B,{noWrap:!0,variant:"inherit",sx:{minWidth:180,maxWidth:340,typography:"subtitle2",..._.value&&{fontWeight:"fontWeightBold"}},children:p})]})}),e.jsx(E,{align:"center",onClick:d,sx:{whiteSpace:"nowrap",...!h&&{py:1.25}},children:x}),e.jsxs(E,{align:"left",onClick:d,sx:{color:"text.primary",whiteSpace:"nowrap",...!h&&{py:1.25}},children:[w.toLowerCase().startsWith("fail")&&T&&e.jsx(pe,{title:T,children:e.jsx(ye,{variant:"soft",color:f,children:w})}),(!w.toLowerCase().startsWith("fail")||!T)&&e.jsx(ye,{variant:"soft",color:f,children:w})]}),e.jsx(E,{onClick:d,sx:{whiteSpace:"nowrap",...!h&&{py:1.25}},children:Oe(j)}),e.jsx(E,{onClick:d,sx:{whiteSpace:"nowrap",...!h&&{py:1.25}},children:n}),e.jsx(E,{onClick:d,sx:{whiteSpace:"nowrap",...!h&&{py:1.25}},children:e.jsxs(c,{direction:"row",spacing:1,alignItems:"baseline",children:[e.jsx(B,{variant:"body2",children:be(new Date(g),"dd MMM yyyy")}),e.jsx(B,{variant:"caption",color:"text.secondary",children:be(new Date(g),"p")})]})}),e.jsx(E,{align:"right",onClick:d,sx:{width:100,minWidth:100,maxWidth:110,...!h&&{py:1.25}},children:e.jsx(Ee,{max:4,sx:{display:"inline-flex",[`& .${Te.avatar}`]:{width:24,height:24,"&:first-of-type":{fontSize:12}}},children:A&&A.map(b=>e.jsx(xe,{alt:b.name,src:b.photo?b.photo:b.avatarUrl},b.id))})}),e.jsx(E,{align:"right",sx:{pl:1,pr:2,whiteSpace:"nowrap",...!h&&{py:1.25}},children:e.jsx(K,{color:C.open?"inherit":"default",onClick:C.onOpen,children:e.jsx(y,{icon:Ks})})})]}),e.jsx(ne,{open:C.open,onClose:C.onClose,arrow:"right-center",sx:{width:160},children:e.jsxs(se,{onClick:()=>{u.onTrue(),C.onClose()},sx:{color:"error.main"},children:[e.jsx(y,{icon:"gravity-ui:trash-bin",width:18}),"Delete"]})}),e.jsx(Xs,{item:r,favorited:L.value,onFavorite:L.onToggle,onCopyLink:D,open:_.value,onClose:_.onFalse,onDelete:a}),e.jsx(Le,{open:u.value,onClose:u.onFalse,title:"Confirm",content:"Are you sure to delete?",action:e.jsx(P,{variant:"contained",color:"error",onClick:a,children:"Delete"})})]})}function st({filters:s,onFilters:r,canReset:h,onResetFilters:t,results:i,...a}){const o=Ps(s.startDate,s.endDate),v=n=>{const x=s.types.filter(g=>g!==n);r("types",x)},p=n=>{const x=s.statuses.filter(g=>g!==n);r("statuses",x)},j=()=>{r("startDate",null),r("endDate",null)};return e.jsxs(c,{spacing:1.5,direction:"row",alignItems:"center",...a,children:[e.jsxs(F,{sx:{typography:"body2"},children:[e.jsx("strong",{children:i}),e.jsx(F,{component:"span",sx:{color:"text.secondary",ml:.75},children:"found"})]}),e.jsxs(c,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[!!s.types.length&&e.jsx(oe,{label:"Types:",children:s.types.map(n=>e.jsx(H,{label:n,size:"small",onDelete:()=>v(n)},n))}),!!s.statuses.length&&e.jsx(oe,{label:"Statuses:",children:s.statuses.map(n=>e.jsx(H,{label:n,size:"small",onDelete:()=>p(n)},n))}),s.startDate&&s.endDate&&e.jsx(oe,{label:"Date:",children:e.jsx(H,{size:"small",label:o,onDelete:j})}),h&&e.jsx(P,{size:"small",color:"error",onClick:t,startIcon:e.jsx(y,{icon:"gravity-ui:trash-bin",width:18}),children:"Clear"})]})]})}function oe({label:s,children:r,sx:h,...t}){return e.jsxs(c,{component:Qe,variant:"outlined",spacing:1,direction:"row",sx:{p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed",...h},...t,children:[e.jsx(F,{component:"span",sx:{typography:"subtitle2"},children:s}),e.jsx(c,{spacing:1,direction:"row",flexWrap:"wrap",children:r})]})}const tt=[{id:"name",label:"Name",minWidth:180,width:200,maxWidth:300},{id:"chunks",label:"Chunks",width:100,align:"center"},{id:"status",label:"Status",width:100,maxWidth:120},{id:"size",label:"Size",width:80,maxWidth:140},{id:"type",label:"Type",width:80,maxWidth:140},{id:"modifiedAt",label:"Modified",width:110},{id:"shared",label:"Modified by",align:"right",width:110,minWidth:110,maxWidth:120},{id:"",width:60,minWidth:40}];function nt({kbId:s,indexName:r,table:h,tableData:t,notFound:i,dataFiltered:a,filters:o,dateError:v,canReset:p,onDeleteRow:j,onFilters:n,onResetFilters:x,onOpenConfirm:g,onUpdateRow:A}){const w=Ze(),{enqueueSnackbar:S}=me(),[T,I]=m.useState(""),[W,L]=m.useState(!1),_=Array.from(new Set(t.map(k=>k.type).flat())),u=Ie(),C=M(),d=M(),{dense:D,page:f,order:b,orderBy:l,rowsPerPage:R,selected:z,setSelected:G,onSelectRow:Z,onSelectAllRows:V,onSort:ie,onChangeDense:re,onChangePage:U,onChangeRowsPerPage:Ne}=h,je=k=>{I(k)},fe=async()=>{z.forEach(k=>{const O=a.find(X=>X.id===k);if(!O)return;const Y={filePrefix:O.name,indexName:r,containerName:O.storage.container};A({...O,status:"Preparing..."}),L(!0),ms(s,k,Y).then(()=>L(!1)).catch(X=>{S(X,{variant:"error"}),console.error("An error occurred while indexing the file:",X)})}),G([])},Ge=()=>{t.filter(Y=>z.includes(Y.id)).filter(Y=>Y.status==="Indexed").length>0?d.onTrue():fe()},He=a.filter(k=>z.includes(k.id)).map(k=>({id:k.id,name:k.name,type:k.type,index:r,status:k.status})),qe=e.jsx(c,{spacing:2,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:e.jsx(Zs,{openDateRange:C.value,onCloseDateRange:C.onFalse,onOpenDateRange:C.onTrue,filters:o,onFilters:n,dateError:v,typeOptions:_,statusOptions:Os})}),Ye=e.jsx(st,{filters:o,onResetFilters:x,canReset:p,onFilters:n,results:a.length}),Je=D?51:60;return e.jsxs(ue,{sx:{p:0},children:[e.jsxs(c,{spacing:1,alignItems:"center",justifyContent:"space-between",direction:{xs:"column",md:"row"},sx:{mt:{xs:3,md:2.5},mb:{xs:1.5,md:1},mx:2.5},children:[e.jsxs(c,{spacing:2.5,sx:{my:{xs:1,md:0},width:{xs:1,md:"auto"}},children:[qe,p&&Ye]}),e.jsxs(c,{direction:"row",spacing:1.5,alignItems:"center",alignSelf:{xs:"end",md:"auto"},children:[e.jsx(K,{size:"small",onClick:()=>je("code"),children:e.jsx(F,{component:"img",src:"/assets/icons/modules/ic_copilot.svg",sx:{width:26,height:26,cursor:"pointer"}})}),e.jsx(J,{size:"small",loading:W,disabled:i||z.length===0,variant:u.themeMode==="dark"?"soft":"contained",color:"primary",startIcon:e.jsx(y,{icon:bs,width:14}),sx:{px:1.5,py:2,mr:0},onClick:Ge,children:"Index"})]})]}),e.jsxs(F,{sx:{position:"relative"},children:[e.jsx(Ws,{dense:D,numSelected:z.length,rowCount:a.length,checkboxMl:0,denseCheckboxMl:0,onSelectAllRows:k=>V(k,a.map(O=>O.id)),action:e.jsx(pe,{title:"Delete",children:e.jsx(K,{color:"error",onClick:g,children:e.jsx(y,{icon:"gravity-ui:trash-bin",width:18})})}),sx:{pl:2,pr:2}}),e.jsx(Me,{children:e.jsxs(Be,{size:D?"small":"medium",sx:{minWidth:960},children:[e.jsx(zs,{dense:D,order:b,checkboxMl:1.1,orderBy:l,headLabel:tt,rowCount:a.length,numSelected:z.length,onSort:ie,onSelectAllRows:k=>V(k,a.map(O=>O.id))}),e.jsxs($e,{children:[a.slice(f*R,f*R+R).map(k=>e.jsx(et,{kbId:s,row:k,dense:D,selected:z.includes(k.id),onSelectRow:()=>Z(k.id),onDeleteRow:()=>j(k.id),onUpdateRow:A},k.id)),e.jsx(Ls,{height:Je,emptyRows:_s(f,R,t.length)}),e.jsx(Ms,{notFound:i,sx:{m:1,borderRadius:1.5,border:`dashed 1px ${w.palette.divider}`}})]})]})})]}),e.jsx(Bs,{count:a.length,page:f,rowsPerPage:R,onPageChange:U,onRowsPerPageChange:Ne,dense:D,onChangeDense:re,sx:{[`& .${Ve.toolbar}`]:{borderTop:i?`dashed 1px ${w.palette.divider}`:"None"}}}),e.jsx(Le,{open:d.value,onClose:d.onFalse,title:"Delete?",content:e.jsx(e.Fragment,{children:"Your choices include indexed files. Could you confirm if you'd like to re-index?"}),action:e.jsx(P,{variant:"contained",color:"error",onClick:()=>{fe(),d.onFalse()},children:"Confirm"})}),e.jsx(Is,{indexName:r,open:!!T,selectedKbs:He,onClose:()=>je(""),callBack:()=>{}})]})}const ve={name:"",types:[],statuses:[],startDate:null,endDate:null},at=e.jsx($,{container:!0,children:e.jsx($,{item:!0,xs:12,children:e.jsx(ce,{rowNumber:8})})});function it({kbMeta:s,refreshKey:r,openUpload:h,onCloseUpload:t}){const{enqueueSnackbar:i}=me(),{user:a}=Xe(),o=$s({defaultOrder:"desc",defaultRowsPerPage:10,defaultOrderBy:"modifiedAt"}),v=M(),{kbItems:p,isLoading:j}=us(s.id,r),[n,x]=m.useState([]);m.useEffect(()=>{j||x(p)},[p,j]);const[g,A]=m.useState(ve),w=g.startDate&&g.endDate?g.startDate.getTime()>g.endDate.getTime():!1,S=rt({inputData:n,comparator:Es(o.order,o.orderBy),filters:g,dateError:w}),T=S.slice(o.page*o.rowsPerPage,o.page*o.rowsPerPage+o.rowsPerPage),I=!S.length||!S.length,W=!!g.name||!!g.types.length||!!g.statuses.length||!!g.startDate&&!!g.endDate,L=m.useCallback((f,b)=>{o.onResetPage(),A(l=>({...l,[f]:b}))},[o]),_=m.useCallback((f,b)=>{if(b==="replace"){x(l=>l.map(R=>f.id===R.id?f:R));return}x(l=>[f,...l])},[x]),u=m.useCallback(f=>{x(b=>b.map(l=>f.id===l.id?f:l))},[x]),C=m.useCallback(f=>{x(b=>b.filter(l=>l.id!==f)),o.onUpdatePageDeleteRow(T.length)},[T.length,o]),d=m.useCallback(()=>{A(ve)},[]),D=async f=>{const b=await As(a==null?void 0:a.photoURL);f.forEach((l,R)=>{const z=os(),G=new FormData;G.append("file",l);const Z=[{id:"1",name:(a==null?void 0:a.displayName)||"Anonymous",email:(a==null?void 0:a.username)||"Anonymous",photo:b||"",permission:"edit",avatarUrl:b?"":"/assets/avatars/avatar_1.jpg"}],V={fileName:l.name,id:z,size:l.size,shared:Z},ie={id:z,name:l.name,storage:{account:"",container:""},url:"",createdAt:new Date,modifiedAt:new Date,type:l.name.split(".").pop()||"",status:"Uploading...",size:l.size,chunks:0,tags:[],shared:Z,isFavorited:!1},re=JSON.stringify(V);G.append("additionalData",re),_(ie),gs(s.id,G).then(U=>{U&&U.success?_(U.item,"replace"):(C(z),i(U.message,{variant:"error"}))}).catch(U=>{C(z),i(U,{variant:"error"}),console.error("An error occurred while uploading the file:",U)})})};return e.jsxs(e.Fragment,{children:[j&&at,!j&&e.jsx(nt,{kbId:s.id,indexName:s.index?s.index:"",table:o,tableData:n,dataFiltered:S,onDeleteRow:C,notFound:I,filters:g,dateError:w,canReset:W,onFilters:L,onResetFilters:d,onOpenConfirm:v.onTrue,onUpdateRow:u}),e.jsx(Ys,{kbId:s.id,onUpload:D,open:h,onClose:t})]})}function rt({inputData:s,comparator:r,filters:h,dateError:t}){const{name:i,types:a,statuses:o,startDate:v,endDate:p}=h,j=s.map((n,x)=>[n,x]);return j.sort((n,x)=>{const g=r(n[0],x[0]);return g!==0?g:n[1]-x[1]}),s=j.map(n=>n[0]),i&&(s=s.filter(n=>n.name.toLowerCase().indexOf(i.toLowerCase())!==-1)),a.length&&(s=s.filter(n=>a.includes(ge(n.type)))),o.length&&(s=s.filter(n=>o.includes(n.status))),t||v&&p&&(s=s.filter(n=>ee(n.createdAt)>=ee(v)&&ee(n.createdAt)<=ee(p))),s}const ot=e.jsxs($,{container:!0,spacing:3,children:[e.jsx($,{item:!0,xs:12,children:e.jsx(q,{variant:"text",width:100,height:56})}),e.jsx($,{item:!0,xs:12,children:e.jsx(q,{variant:"text",width:300,height:42,sx:{mt:-3.5}})}),e.jsx($,{item:!0,xs:12,children:e.jsx(ce,{rowNumber:1})}),e.jsx($,{item:!0,xs:12,children:e.jsx(ce,{rowNumber:8})})]});function Ot(){const s=cs(),{id:r}=s,h=Ie(),t=M(),[i,a]=m.useState(0),{kbMeta:o,isLoading:v}=js(r,i),p=()=>{a(Math.floor(Math.random()*1e3))};return e.jsxs(e.Fragment,{children:[e.jsx(es,{children:e.jsx("title",{children:" GBB/AI: KMM Detail"})}),e.jsxs(ss,{maxWidth:h.themeStretch?!1:"xl",children:[v&&ot,!v&&o&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{mb:3},direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(B,{variant:"h4",children:o.name}),e.jsxs(c,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(K,{size:"small",onClick:p,sx:{width:30,height:30,color:"inherit"},children:e.jsx(y,{icon:ls})}),e.jsx(P,{size:"small",variant:"contained",startIcon:e.jsx(ts,{icon:as}),onClick:t.onTrue,children:"Source"})]})]}),e.jsx(fs,{links:[{name:"Knowledge base",href:ns.gbbai.kb.root},{name:o.name}],sx:{mb:{xs:2,md:3},mt:{xs:-1.5,md:-2}}}),e.jsxs(c,{spacing:2,children:[e.jsx(qs,{kb:o}),o.type.toLowerCase()==="kb"&&e.jsx(it,{kbMeta:o,refreshKey:i,openUpload:t.value,onCloseUpload:t.onFalse})]})]})]})]})}export{Ot as default};
